import { Component, Input, Output, EventEmitter, ElementRef, ContentChildren, QueryList, NgModule } from '@angular/core';
import 'rxjs';
import { CommonModule } from '@angular/common';

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
/**
 * @param {?} node
 * @return {?}
 */
function updatePicture(node) {
    const /** @type {?} */ drawingNode = node.getLayer() || node.getStage();
    if (drawingNode) {
        drawingNode.batchDraw();
    }
}

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
/**
 * @param {?} component
 * @param {?=} props
 * @param {?=} oldProps
 * @return {?}
 */
function applyNodeProps(component, props = {}, oldProps = {}) {
    if ('id' in props) {
        // tslint:disable-next-line:max-line-length
        const /** @type {?} */ message = `ng2-konva: You are using "id" attribute for Konva node. In some very rare cases it may produce bugs. Currently we recommend not to use it and use "name" attribute instead.`;
        console.warn(message);
    }
    const /** @type {?} */ instance = component._stage;
    const /** @type {?} */ updatedProps = {};
    let /** @type {?} */ hasUpdates = false;
    Object.keys(oldProps).forEach(key => {
        const /** @type {?} */ isEvent = key.slice(0, 2) === 'on';
        const /** @type {?} */ propChanged = oldProps[key] !== props[key];
        if (isEvent && propChanged) {
            let /** @type {?} */ eventName = key.substr(2).toLowerCase();
            if (eventName.substr(0, 7) === 'content') {
                eventName =
                    'content' +
                        eventName.substr(7, 1).toUpperCase() +
                        eventName.substr(8);
            }
            instance.off(eventName, oldProps[key]);
        }
        const /** @type {?} */ toRemove = !props.hasOwnProperty(key);
        if (toRemove) {
            instance.setAttr(key, undefined);
        }
    });
    Object.keys(props).forEach(key => {
        let /** @type {?} */ isEvent = key.slice(0, 2) === 'on';
        const /** @type {?} */ toAdd = oldProps[key] !== props[key];
        if (isEvent && toAdd) {
            let /** @type {?} */ eventName = key.substr(2).toLowerCase();
            if (eventName.substr(0, 7) === 'content') {
                eventName =
                    'content' +
                        eventName.substr(7, 1).toUpperCase() +
                        eventName.substr(8);
            }
            if (props[key]) {
                instance.off(eventName);
                instance.on(eventName, evt => {
                    props[key](evt.target.AngularComponent, evt);
                });
            }
        }
        if (!isEvent &&
            (props[key] !== oldProps[key] || props[key] !== instance.getAttr(key))) {
            hasUpdates = true;
            updatedProps[key] = props[key];
        }
    });
    if (hasUpdates) {
        instance.setAttrs(updatedProps);
        updatePicture(instance);
        let /** @type {?} */ val;
        Object.keys(updatedProps).forEach(prop => {
            val = updatedProps[prop];
            if (val instanceof Image && !val.complete) {
                const /** @type {?} */ node = instance;
                val.addEventListener('load', function () {
                    const /** @type {?} */ layer = node.getLayer();
                    if (layer) {
                        layer.batchDraw();
                    }
                });
            }
        });
    }
}

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
/**
 * @param {?} str
 * @return {?}
 */
function camelize(str) {
    return str
        .replace(/(?:^\w|[A-Z]|\b\w)/g, function (letter, index) {
        return index == 0 ? letter.toLowerCase() : letter.toUpperCase();
    })
        .replace(/\s+/g, '');
}
/**
 * @param {?} string
 * @return {?}
 */
function capitalizeFirstLetter(string) {
    return string.charAt(0).toUpperCase() + string.slice(1);
}
/**
 * @param {?} componentTag
 * @return {?}
 */
function getName(componentTag) {
    return capitalizeFirstLetter(camelize(componentTag.substr(3).replace('-', ' ')));
}
/**
 * @param {?} instance
 * @return {?}
 */
function createListener(instance) {
    const /** @type {?} */ output = {};
    [
        'click',
        'dblclick',
        'mouseover',
        'mouseout',
        'mousemove',
        'tap',
        'dbltap',
        'touchstart',
        'scaleXChange',
        'fillChange',
        'dragstart',
        'dragmove',
        'dragend',
    ].forEach(eventName => {
        if (instance[eventName].observers.length) {
            output['on' + eventName] = instance[eventName].emit.bind(instance[eventName]);
        }
    });
    return output;
}

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
class CoreShapeComponent {
    /**
     * @param {?} elementRef
     */
    constructor(elementRef) {
        this.elementRef = elementRef;
        this.shapes = new QueryList();
        this.click = new EventEmitter();
        this.dblclick = new EventEmitter();
        this.mouseover = new EventEmitter();
        this.mouseout = new EventEmitter();
        this.mousemove = new EventEmitter();
        this.tap = new EventEmitter();
        this.dbltap = new EventEmitter();
        this.touchstart = new EventEmitter();
        this.scaleXChange = new EventEmitter();
        this.fillChange = new EventEmitter();
        this.dragstart = new EventEmitter();
        this.dragmove = new EventEmitter();
        this.dragend = new EventEmitter();
        this.added = false;
        this.cacheProps = {};
        this._stage = {};
        this.nameNode = getName(elementRef.nativeElement.localName);
    }
    /**
     * @return {?}
     */
    getStage() {
        return this._stage;
    }
    /**
     * @return {?}
     */
    getConfig() {
        return this._config || {};
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.initKonva();
    }
    /**
     * @return {?}
     */
    initKonva() {
        const /** @type {?} */ ng = this;
        const /** @type {?} */ NodeClass = Konva[this.nameNode];
        this._stage = new NodeClass();
        this._stage.AngularComponent = this;
        const /** @type {?} */ animationStage = this._stage.to.bind(this._stage);
        this._stage.to = function (newConfig) {
            animationStage(newConfig);
            setTimeout(() => {
                Object.keys(ng._stage.attrs).forEach(key => {
                    if (typeof ng._stage.attrs[key] !== 'function') {
                        ng.config[key] = ng._stage.attrs[key];
                    }
                });
            }, 200);
        };
        if (this.config) {
            this.config.subscribe(config => {
                this._config = config;
                this.uploadKonva(config);
            });
        }
    }
    /**
     * @param {?} config
     * @return {?}
     */
    uploadKonva(config) {
        const /** @type {?} */ props = Object.assign({}, config, createListener(this));
        applyNodeProps(this, props, this.cacheProps);
        this.cacheProps = props;
    }
    /**
     * @return {?}
     */
    ngAfterContentInit() {
        this.shapes.forEach((item) => {
            if (this !== item) {
                item.added = true;
                this._stage.add(item.getStage());
                updatePicture(this._stage);
            }
        });
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this._stage.destroy();
    }
}
CoreShapeComponent.decorators = [
    { type: Component, args: [{
                // tslint:disable-next-line:max-line-length
                selector: 'ko-shape, ko-layer, ko-circle, ko-fastlayer, ko-group, ko-label, ko-rect, ko-ellipse, ko-wedge, ko-line, ko-sprite, ko-image, ko-text, ko-text-path, ko-star, ko-ring, ko-arc, ko-tag, ko-path, ko-regular-polygon, ko-arrow',
                template: `<div><ng-content></ng-content></div>`
            },] },
];
/** @nocollapse */
CoreShapeComponent.ctorParameters = () => [
    { type: ElementRef }
];
CoreShapeComponent.propDecorators = {
    shapes: [{ type: ContentChildren, args: [CoreShapeComponent,] }],
    config: [{ type: Input }],
    click: [{ type: Output }],
    dblclick: [{ type: Output }],
    mouseover: [{ type: Output }],
    mouseout: [{ type: Output }],
    mousemove: [{ type: Output }],
    tap: [{ type: Output }],
    dbltap: [{ type: Output }],
    touchstart: [{ type: Output }],
    scaleXChange: [{ type: Output }],
    fillChange: [{ type: Output }],
    dragstart: [{ type: Output }],
    dragmove: [{ type: Output }],
    dragend: [{ type: Output }]
};

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
class StageComponent {
    /**
     * @param {?} elementRef
     */
    constructor(elementRef) {
        this.elementRef = elementRef;
        this.shapes = new QueryList();
        this.click = new EventEmitter();
        this.dblclick = new EventEmitter();
        this.mouseover = new EventEmitter();
        this.mouseout = new EventEmitter();
        this.mousemove = new EventEmitter();
        this.tap = new EventEmitter();
        this.dbltap = new EventEmitter();
        this.touchstart = new EventEmitter();
        this.scaleXChange = new EventEmitter();
        this.fillChange = new EventEmitter();
        this.dragstart = new EventEmitter();
        this.dragmove = new EventEmitter();
        this.dragend = new EventEmitter();
        this.cacheProps = {};
    }
    /**
     * @return {?}
     */
    getStage() {
        return this._stage || {};
    }
    /**
     * @return {?}
     */
    getConfig() {
        return this._config || {};
    }
    /**
     * @param {?} config
     * @return {?}
     */
    uploadKonva(config) {
        const /** @type {?} */ props = Object.assign({}, config, createListener(this));
        applyNodeProps(this, props, this.cacheProps);
        this.cacheProps = props;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        const /** @type {?} */ nodeContainer = this.elementRef.nativeElement;
        this.config.subscribe(config => {
            this._config = config;
            if (!this._stage) {
                this._stage = new Konva.Stage({
                    width: config.width,
                    height: config.height,
                    container: nodeContainer
                });
                this.uploadKonva(config);
            }
            else {
                this.uploadKonva(config);
            }
        });
    }
    /**
     * @return {?}
     */
    ngAfterContentInit() {
        this.shapes.forEach((item) => {
            this._stage.add(item.getStage());
            updatePicture(this._stage);
        });
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this._stage.destroy();
    }
}
StageComponent.decorators = [
    { type: Component, args: [{
                selector: 'ko-stage',
                template: `<div><ng-content></ng-content>{{config}}</div>`
            },] },
];
/** @nocollapse */
StageComponent.ctorParameters = () => [
    { type: ElementRef }
];
StageComponent.propDecorators = {
    shapes: [{ type: ContentChildren, args: [CoreShapeComponent,] }],
    config: [{ type: Input }],
    click: [{ type: Output }],
    dblclick: [{ type: Output }],
    mouseover: [{ type: Output }],
    mouseout: [{ type: Output }],
    mousemove: [{ type: Output }],
    tap: [{ type: Output }],
    dbltap: [{ type: Output }],
    touchstart: [{ type: Output }],
    scaleXChange: [{ type: Output }],
    fillChange: [{ type: Output }],
    dragstart: [{ type: Output }],
    dragmove: [{ type: Output }],
    dragend: [{ type: Output }]
};

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
if (typeof window !== 'undefined' && !window.Konva) {
    require('konva');
}
class KonvaModule {
}
KonvaModule.decorators = [
    { type: NgModule, args: [{
                imports: [
                    CommonModule
                ],
                declarations: [
                    StageComponent,
                    CoreShapeComponent,
                ],
                exports: [
                    StageComponent,
                    CoreShapeComponent,
                ]
            },] },
];

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */

export { KonvaModule, StageComponent, CoreShapeComponent };

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmcyLWtvbnZhLmpzLm1hcCIsInNvdXJjZXMiOlsibmc6Ly9uZzIta29udmEvbGliL3V0aWxzL3VwZGF0ZVBpY3R1cmUudHMiLCJuZzovL25nMi1rb252YS9saWIvdXRpbHMvYXBwbHlOb2RlUHJvcHMudHMiLCJuZzovL25nMi1rb252YS9saWIvdXRpbHMvaW5kZXgudHMiLCJuZzovL25nMi1rb252YS9saWIvY29tcG9uZW50cy9jb3JlLXNoYXBlLmNvbXBvbmVudC50cyIsIm5nOi8vbmcyLWtvbnZhL2xpYi9jb21wb25lbnRzL3N0YWdlLmNvbXBvbmVudC50cyIsIm5nOi8vbmcyLWtvbnZhL2xpYi9rb252YS5tb2R1bGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gYWRhcHRlZCBGUk9NOiBodHRwczovL2dpdGh1Yi5jb20vbGF2cnRvbi9yZWFjdC1rb252YS9ibG9iL21hc3Rlci9zcmMvcmVhY3Qta29udmEtZmliZXIuanNcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIHVwZGF0ZVBpY3R1cmUobm9kZSkge1xyXG4gIGNvbnN0IGRyYXdpbmdOb2RlID0gbm9kZS5nZXRMYXllcigpIHx8IG5vZGUuZ2V0U3RhZ2UoKTtcclxuICBpZiAoZHJhd2luZ05vZGUpIHtcclxuICAgIGRyYXdpbmdOb2RlLmJhdGNoRHJhdygpO1xyXG4gIH1cclxufVxyXG4iLCIvLyBhZGFwdGVkIEZST006IGh0dHBzOi8vZ2l0aHViLmNvbS9sYXZydG9uL3JlYWN0LWtvbnZhL2Jsb2IvbWFzdGVyL3NyYy9yZWFjdC1rb252YS1maWJlci5qc1xyXG5cclxuaW1wb3J0IHVwZGF0ZVBpY3R1cmUgZnJvbSAnLi91cGRhdGVQaWN0dXJlJztcclxuXHJcbmRlY2xhcmUgY29uc3QgSW1hZ2U6IGFueTtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGFwcGx5Tm9kZVByb3BzKGNvbXBvbmVudCwgcHJvcHMgPSB7fSwgb2xkUHJvcHMgPSB7fSkge1xyXG4gIGlmICgnaWQnIGluIHByb3BzKSB7XHJcbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bWF4LWxpbmUtbGVuZ3RoXHJcbiAgICBjb25zdCBtZXNzYWdlID0gYG5nMi1rb252YTogWW91IGFyZSB1c2luZyBcImlkXCIgYXR0cmlidXRlIGZvciBLb252YSBub2RlLiBJbiBzb21lIHZlcnkgcmFyZSBjYXNlcyBpdCBtYXkgcHJvZHVjZSBidWdzLiBDdXJyZW50bHkgd2UgcmVjb21tZW5kIG5vdCB0byB1c2UgaXQgYW5kIHVzZSBcIm5hbWVcIiBhdHRyaWJ1dGUgaW5zdGVhZC5gO1xyXG4gICAgY29uc29sZS53YXJuKG1lc3NhZ2UpO1xyXG4gIH1cclxuXHJcbiAgY29uc3QgaW5zdGFuY2UgPSBjb21wb25lbnQuX3N0YWdlO1xyXG4gIGNvbnN0IHVwZGF0ZWRQcm9wcyA9IHt9O1xyXG4gIGxldCBoYXNVcGRhdGVzID0gZmFsc2U7XHJcblxyXG4gIE9iamVjdC5rZXlzKG9sZFByb3BzKS5mb3JFYWNoKGtleSA9PiB7XHJcbiAgICBjb25zdCBpc0V2ZW50ID0ga2V5LnNsaWNlKDAsIDIpID09PSAnb24nO1xyXG4gICAgY29uc3QgcHJvcENoYW5nZWQgPSBvbGRQcm9wc1trZXldICE9PSBwcm9wc1trZXldO1xyXG4gICAgaWYgKGlzRXZlbnQgJiYgcHJvcENoYW5nZWQpIHtcclxuICAgICAgbGV0IGV2ZW50TmFtZSA9IGtleS5zdWJzdHIoMikudG9Mb3dlckNhc2UoKTtcclxuICAgICAgaWYgKGV2ZW50TmFtZS5zdWJzdHIoMCwgNykgPT09ICdjb250ZW50Jykge1xyXG4gICAgICAgIGV2ZW50TmFtZSA9XHJcbiAgICAgICAgICAnY29udGVudCcgK1xyXG4gICAgICAgICAgZXZlbnROYW1lLnN1YnN0cig3LCAxKS50b1VwcGVyQ2FzZSgpICtcclxuICAgICAgICAgIGV2ZW50TmFtZS5zdWJzdHIoOCk7XHJcbiAgICAgIH1cclxuICAgICAgaW5zdGFuY2Uub2ZmKGV2ZW50TmFtZSwgb2xkUHJvcHNba2V5XSk7XHJcbiAgICB9XHJcbiAgICBjb25zdCB0b1JlbW92ZSA9ICFwcm9wcy5oYXNPd25Qcm9wZXJ0eShrZXkpO1xyXG4gICAgaWYgKHRvUmVtb3ZlKSB7XHJcbiAgICAgIGluc3RhbmNlLnNldEF0dHIoa2V5LCB1bmRlZmluZWQpO1xyXG4gICAgfVxyXG4gIH0pO1xyXG4gIE9iamVjdC5rZXlzKHByb3BzKS5mb3JFYWNoKGtleSA9PiB7XHJcbiAgICBsZXQgaXNFdmVudCA9IGtleS5zbGljZSgwLCAyKSA9PT0gJ29uJztcclxuICAgIGNvbnN0IHRvQWRkID0gb2xkUHJvcHNba2V5XSAhPT0gcHJvcHNba2V5XTtcclxuICAgIGlmIChpc0V2ZW50ICYmIHRvQWRkKSB7XHJcbiAgICAgIGxldCBldmVudE5hbWUgPSBrZXkuc3Vic3RyKDIpLnRvTG93ZXJDYXNlKCk7XHJcbiAgICAgIGlmIChldmVudE5hbWUuc3Vic3RyKDAsIDcpID09PSAnY29udGVudCcpIHtcclxuICAgICAgICBldmVudE5hbWUgPVxyXG4gICAgICAgICAgJ2NvbnRlbnQnICtcclxuICAgICAgICAgIGV2ZW50TmFtZS5zdWJzdHIoNywgMSkudG9VcHBlckNhc2UoKSArXHJcbiAgICAgICAgICBldmVudE5hbWUuc3Vic3RyKDgpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChwcm9wc1trZXldKSB7XHJcbiAgICAgICAgaW5zdGFuY2Uub2ZmKGV2ZW50TmFtZSk7XHJcbiAgICAgICAgaW5zdGFuY2Uub24oZXZlbnROYW1lLCBldnQgPT4ge1xyXG4gICAgICAgICAgcHJvcHNba2V5XShldnQudGFyZ2V0LkFuZ3VsYXJDb21wb25lbnQsIGV2dCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGlmIChcclxuICAgICAgIWlzRXZlbnQgJiZcclxuICAgICAgKHByb3BzW2tleV0gIT09IG9sZFByb3BzW2tleV0gfHwgcHJvcHNba2V5XSAhPT0gaW5zdGFuY2UuZ2V0QXR0cihrZXkpKVxyXG4gICAgKSB7XHJcbiAgICAgIGhhc1VwZGF0ZXMgPSB0cnVlO1xyXG4gICAgICB1cGRhdGVkUHJvcHNba2V5XSA9IHByb3BzW2tleV07XHJcbiAgICB9XHJcbiAgfSk7XHJcblxyXG4gIGlmIChoYXNVcGRhdGVzKSB7XHJcbiAgICBpbnN0YW5jZS5zZXRBdHRycyh1cGRhdGVkUHJvcHMpO1xyXG4gICAgdXBkYXRlUGljdHVyZShpbnN0YW5jZSk7XHJcbiAgICBsZXQgdmFsO1xyXG4gICAgT2JqZWN0LmtleXModXBkYXRlZFByb3BzKS5mb3JFYWNoKHByb3AgPT4ge1xyXG4gICAgICB2YWwgPSB1cGRhdGVkUHJvcHNbcHJvcF07XHJcbiAgICAgIGlmICh2YWwgaW5zdGFuY2VvZiBJbWFnZSAmJiAhdmFsLmNvbXBsZXRlKSB7XHJcbiAgICAgICAgY29uc3Qgbm9kZSA9IGluc3RhbmNlO1xyXG4gICAgICAgIHZhbC5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICBjb25zdCBsYXllciA9IG5vZGUuZ2V0TGF5ZXIoKTtcclxuICAgICAgICAgIGlmIChsYXllcikge1xyXG4gICAgICAgICAgICBsYXllci5iYXRjaERyYXcoKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG59XHJcbiIsImltcG9ydCB1cGRhdGVQaWN0dXJlIGZyb20gJy4vdXBkYXRlUGljdHVyZSc7XHJcbmltcG9ydCBhcHBseU5vZGVQcm9wcyBmcm9tICcuL2FwcGx5Tm9kZVByb3BzJztcclxuXHJcbmZ1bmN0aW9uIGNhbWVsaXplKHN0cikge1xyXG4gIHJldHVybiBzdHJcclxuICAgIC5yZXBsYWNlKC8oPzpeXFx3fFtBLVpdfFxcYlxcdykvZywgZnVuY3Rpb24obGV0dGVyLCBpbmRleCkge1xyXG4gICAgICByZXR1cm4gaW5kZXggPT0gMCA/IGxldHRlci50b0xvd2VyQ2FzZSgpIDogbGV0dGVyLnRvVXBwZXJDYXNlKCk7XHJcbiAgICB9KVxyXG4gICAgLnJlcGxhY2UoL1xccysvZywgJycpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBjYXBpdGFsaXplRmlyc3RMZXR0ZXIoc3RyaW5nKSB7XHJcbiAgcmV0dXJuIHN0cmluZy5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHN0cmluZy5zbGljZSgxKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldE5hbWUoY29tcG9uZW50VGFnKSB7XHJcbiAgcmV0dXJuIGNhcGl0YWxpemVGaXJzdExldHRlcihjYW1lbGl6ZShjb21wb25lbnRUYWcuc3Vic3RyKDMpLnJlcGxhY2UoJy0nLCAnICcpKSk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVMaXN0ZW5lcihpbnN0YW5jZTogYW55KSB7XHJcbiAgY29uc3Qgb3V0cHV0ID0ge307XHJcbiAgW1xyXG4gICAgJ2NsaWNrJyxcclxuICAgICdkYmxjbGljaycsXHJcbiAgICAnbW91c2VvdmVyJyxcclxuICAgICdtb3VzZW91dCcsXHJcbiAgICAnbW91c2Vtb3ZlJyxcclxuICAgICd0YXAnLFxyXG4gICAgJ2RibHRhcCcsXHJcbiAgICAndG91Y2hzdGFydCcsXHJcbiAgICAnc2NhbGVYQ2hhbmdlJyxcclxuICAgICdmaWxsQ2hhbmdlJyxcclxuICAgICdkcmFnc3RhcnQnLFxyXG4gICAgJ2RyYWdtb3ZlJyxcclxuICAgICdkcmFnZW5kJyxcclxuICBdLmZvckVhY2goZXZlbnROYW1lID0+IHtcclxuICAgIGlmIChpbnN0YW5jZVtldmVudE5hbWVdLm9ic2VydmVycy5sZW5ndGgpIHtcclxuICAgICAgb3V0cHV0WydvbicgKyBldmVudE5hbWVdID0gaW5zdGFuY2VbZXZlbnROYW1lXS5lbWl0LmJpbmQoXHJcbiAgICAgICAgaW5zdGFuY2VbZXZlbnROYW1lXVxyXG4gICAgICApO1xyXG4gICAgfVxyXG4gIH0pO1xyXG4gIHJldHVybiBvdXRwdXQ7XHJcbn1cclxuXHJcbmV4cG9ydCB7IHVwZGF0ZVBpY3R1cmUsIGFwcGx5Tm9kZVByb3BzIH07XHJcbiIsImltcG9ydCB7XHJcbiAgQ29tcG9uZW50LFxyXG4gIElucHV0LFxyXG4gIE91dHB1dCxcclxuICBFdmVudEVtaXR0ZXIsXHJcbiAgRWxlbWVudFJlZixcclxuICBBZnRlckNvbnRlbnRJbml0LFxyXG4gIENvbnRlbnRDaGlsZHJlbixcclxuICBRdWVyeUxpc3QsXHJcbiAgT25EZXN0cm95LFxyXG4gIE9uSW5pdCxcclxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQge1xyXG4gIGdldE5hbWUsXHJcbiAgY3JlYXRlTGlzdGVuZXIsXHJcbiAgYXBwbHlOb2RlUHJvcHMsXHJcbiAgdXBkYXRlUGljdHVyZVxyXG59IGZyb20gJy4uL3V0aWxzL2luZGV4JztcclxuaW1wb3J0IHsgS29udmFDb21wb25lbnQgfSBmcm9tICcuLi9rby5pbnRlcmZhY2UnO1xyXG5cclxuZGVjbGFyZSBjb25zdCBLb252YTogYW55O1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm1heC1saW5lLWxlbmd0aFxyXG4gIHNlbGVjdG9yOlxyXG4gICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm1heC1saW5lLWxlbmd0aFxyXG4gICAgJ2tvLXNoYXBlLCBrby1sYXllciwga28tY2lyY2xlLCBrby1mYXN0bGF5ZXIsIGtvLWdyb3VwLCBrby1sYWJlbCwga28tcmVjdCwga28tZWxsaXBzZSwga28td2VkZ2UsIGtvLWxpbmUsIGtvLXNwcml0ZSwga28taW1hZ2UsIGtvLXRleHQsIGtvLXRleHQtcGF0aCwga28tc3Rhciwga28tcmluZywga28tYXJjLCBrby10YWcsIGtvLXBhdGgsIGtvLXJlZ3VsYXItcG9seWdvbiwga28tYXJyb3cnLFxyXG4gIHRlbXBsYXRlOiBgPGRpdj48bmctY29udGVudD48L25nLWNvbnRlbnQ+PC9kaXY+YFxyXG59KVxyXG5leHBvcnQgY2xhc3MgQ29yZVNoYXBlQ29tcG9uZW50XHJcbiAgaW1wbGVtZW50cyBLb252YUNvbXBvbmVudCwgQWZ0ZXJDb250ZW50SW5pdCwgT25EZXN0cm95LCBPbkluaXQge1xyXG4gIEBDb250ZW50Q2hpbGRyZW4oQ29yZVNoYXBlQ29tcG9uZW50KVxyXG4gIHNoYXBlcyA9IG5ldyBRdWVyeUxpc3Q8Q29yZVNoYXBlQ29tcG9uZW50PigpO1xyXG4gIEBJbnB1dCgpIGNvbmZpZzogT2JzZXJ2YWJsZTxhbnk+O1xyXG4gIEBPdXRwdXQoKSBjbGljazogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgQE91dHB1dCgpIGRibGNsaWNrOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICBAT3V0cHV0KCkgbW91c2VvdmVyOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICBAT3V0cHV0KCkgbW91c2VvdXQ6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gIEBPdXRwdXQoKSBtb3VzZW1vdmU6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gIEBPdXRwdXQoKSB0YXA6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gIEBPdXRwdXQoKSBkYmx0YXA6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gIEBPdXRwdXQoKSB0b3VjaHN0YXJ0OiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICBAT3V0cHV0KCkgc2NhbGVYQ2hhbmdlOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICBAT3V0cHV0KCkgZmlsbENoYW5nZTogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgQE91dHB1dCgpIGRyYWdzdGFydDogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgQE91dHB1dCgpIGRyYWdtb3ZlOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICBAT3V0cHV0KCkgZHJhZ2VuZDogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcblxyXG4gIHB1YmxpYyBuYW1lTm9kZTogc3RyaW5nO1xyXG4gIHB1YmxpYyBhZGRlZCA9IGZhbHNlO1xyXG5cclxuICBwcml2YXRlIGNhY2hlUHJvcHM6IGFueSA9IHt9O1xyXG4gIHByaXZhdGUgX3N0YWdlOiBhbnkgPSB7fTtcclxuICBwcml2YXRlIF9jb25maWc7XHJcblxyXG4gIHB1YmxpYyBnZXRTdGFnZSgpIHtcclxuICAgIHJldHVybiB0aGlzLl9zdGFnZTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXRDb25maWcoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fY29uZmlnIHx8IHt9O1xyXG4gIH1cclxuXHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBlbGVtZW50UmVmOiBFbGVtZW50UmVmKSB7XHJcbiAgICB0aGlzLm5hbWVOb2RlID0gZ2V0TmFtZShlbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQubG9jYWxOYW1lKTtcclxuICB9XHJcblxyXG4gIG5nT25Jbml0KCkge1xyXG4gICAgdGhpcy5pbml0S29udmEoKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgaW5pdEtvbnZhKCkge1xyXG4gICAgY29uc3QgbmcgPSB0aGlzO1xyXG4gICAgY29uc3QgTm9kZUNsYXNzID0gS29udmFbdGhpcy5uYW1lTm9kZV07XHJcbiAgICB0aGlzLl9zdGFnZSA9IG5ldyBOb2RlQ2xhc3MoKTtcclxuICAgIHRoaXMuX3N0YWdlLkFuZ3VsYXJDb21wb25lbnQgPSB0aGlzO1xyXG4gICAgY29uc3QgYW5pbWF0aW9uU3RhZ2UgPSB0aGlzLl9zdGFnZS50by5iaW5kKHRoaXMuX3N0YWdlKTtcclxuXHJcbiAgICB0aGlzLl9zdGFnZS50byA9IGZ1bmN0aW9uKG5ld0NvbmZpZykge1xyXG4gICAgICBhbmltYXRpb25TdGFnZShuZXdDb25maWcpO1xyXG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICBPYmplY3Qua2V5cyhuZy5fc3RhZ2UuYXR0cnMpLmZvckVhY2goa2V5ID0+IHtcclxuICAgICAgICAgIGlmICh0eXBlb2YgbmcuX3N0YWdlLmF0dHJzW2tleV0gIT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgbmcuY29uZmlnW2tleV0gPSBuZy5fc3RhZ2UuYXR0cnNba2V5XTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgfSwgMjAwKTtcclxuICAgIH07XHJcbiAgICBpZiAodGhpcy5jb25maWcpIHtcclxuICAgICAgdGhpcy5jb25maWcuc3Vic2NyaWJlKGNvbmZpZyA9PiB7XHJcbiAgICAgICAgdGhpcy5fY29uZmlnID0gY29uZmlnO1xyXG4gICAgICAgIHRoaXMudXBsb2FkS29udmEoY29uZmlnKTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHVwbG9hZEtvbnZhKGNvbmZpZykge1xyXG4gICAgY29uc3QgcHJvcHMgPSB7XHJcbiAgICAgIC4uLmNvbmZpZyxcclxuICAgICAgLi4uY3JlYXRlTGlzdGVuZXIodGhpcylcclxuICAgIH07XHJcbiAgICBhcHBseU5vZGVQcm9wcyh0aGlzLCBwcm9wcywgdGhpcy5jYWNoZVByb3BzKTtcclxuICAgIHRoaXMuY2FjaGVQcm9wcyA9IHByb3BzO1xyXG4gIH1cclxuXHJcbiAgbmdBZnRlckNvbnRlbnRJbml0KCkge1xyXG4gICAgdGhpcy5zaGFwZXMuZm9yRWFjaCgoaXRlbTogQ29yZVNoYXBlQ29tcG9uZW50KSA9PiB7XHJcbiAgICAgIGlmICh0aGlzICE9PSBpdGVtKSB7XHJcbiAgICAgICAgaXRlbS5hZGRlZCA9IHRydWU7XHJcbiAgICAgICAgdGhpcy5fc3RhZ2UuYWRkKGl0ZW0uZ2V0U3RhZ2UoKSk7XHJcbiAgICAgICAgdXBkYXRlUGljdHVyZSh0aGlzLl9zdGFnZSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgbmdPbkRlc3Ryb3koKSB7XHJcbiAgICB0aGlzLl9zdGFnZS5kZXN0cm95KCk7XHJcbiAgfVxyXG59XHJcbiIsImltcG9ydCB7XHJcbiAgQ29tcG9uZW50LFxyXG4gIElucHV0LFxyXG4gIE91dHB1dCxcclxuICBFdmVudEVtaXR0ZXIsXHJcbiAgQWZ0ZXJDb250ZW50SW5pdCxcclxuICBFbGVtZW50UmVmLFxyXG4gIENvbnRlbnRDaGlsZHJlbixcclxuICBRdWVyeUxpc3QsXHJcbiAgT25Jbml0LFxyXG4gIE9uRGVzdHJveVxyXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBDb3JlU2hhcGVDb21wb25lbnQgYXMgQ29yZVNoYXBlIH0gZnJvbSAnLi9jb3JlLXNoYXBlLmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IE9ic2VydmFibGUgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgdXBkYXRlUGljdHVyZSwgY3JlYXRlTGlzdGVuZXIsIGFwcGx5Tm9kZVByb3BzIH0gZnJvbSAnLi4vdXRpbHMvaW5kZXgnO1xyXG5pbXBvcnQgeyBLb252YUNvbXBvbmVudCB9IGZyb20gJy4uL2tvLmludGVyZmFjZSc7XHJcblxyXG5kZWNsYXJlIGNvbnN0IEtvbnZhOiBhbnk7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ2tvLXN0YWdlJyxcclxuICB0ZW1wbGF0ZTogYDxkaXY+PG5nLWNvbnRlbnQ+PC9uZy1jb250ZW50Pnt7Y29uZmlnfX08L2Rpdj5gXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBTdGFnZUNvbXBvbmVudFxyXG4gIGltcGxlbWVudHMgS29udmFDb21wb25lbnQsIEFmdGVyQ29udGVudEluaXQsIE9uSW5pdCwgT25EZXN0cm95IHtcclxuICBAQ29udGVudENoaWxkcmVuKENvcmVTaGFwZSkgc2hhcGVzID0gbmV3IFF1ZXJ5TGlzdDxDb3JlU2hhcGU+KCk7XHJcbiAgQElucHV0KCkgY29uZmlnOiBPYnNlcnZhYmxlPGFueT47XHJcbiAgQE91dHB1dCgpIGNsaWNrOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICBAT3V0cHV0KCkgZGJsY2xpY2s6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gIEBPdXRwdXQoKSBtb3VzZW92ZXI6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gIEBPdXRwdXQoKSBtb3VzZW91dDogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgQE91dHB1dCgpIG1vdXNlbW92ZTogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgQE91dHB1dCgpIHRhcDogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgQE91dHB1dCgpIGRibHRhcDogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgQE91dHB1dCgpIHRvdWNoc3RhcnQ6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gIEBPdXRwdXQoKSBzY2FsZVhDaGFuZ2U6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gIEBPdXRwdXQoKSBmaWxsQ2hhbmdlOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICBAT3V0cHV0KCkgZHJhZ3N0YXJ0OiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICBAT3V0cHV0KCkgZHJhZ21vdmU6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gIEBPdXRwdXQoKSBkcmFnZW5kOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuXHJcbiAgcHJpdmF0ZSBfc3RhZ2U7XHJcbiAgcHJpdmF0ZSBfY29uZmlnO1xyXG4gIHByaXZhdGUgY2FjaGVQcm9wczogYW55ID0ge307XHJcblxyXG4gIHB1YmxpYyBnZXRTdGFnZSgpIHtcclxuICAgIHJldHVybiB0aGlzLl9zdGFnZSB8fCB7fTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXRDb25maWcoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fY29uZmlnIHx8IHt9O1xyXG4gIH1cclxuXHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBlbGVtZW50UmVmOiBFbGVtZW50UmVmKSB7fVxyXG5cclxuICBwcml2YXRlIHVwbG9hZEtvbnZhKGNvbmZpZykge1xyXG4gICAgY29uc3QgcHJvcHMgPSB7XHJcbiAgICAgIC4uLmNvbmZpZyxcclxuICAgICAgLi4uY3JlYXRlTGlzdGVuZXIodGhpcylcclxuICAgIH07XHJcbiAgICBhcHBseU5vZGVQcm9wcyh0aGlzLCBwcm9wcywgdGhpcy5jYWNoZVByb3BzKTtcclxuICAgIHRoaXMuY2FjaGVQcm9wcyA9IHByb3BzO1xyXG4gIH1cclxuXHJcbiAgbmdPbkluaXQoKSB7XHJcbiAgICBjb25zdCBub2RlQ29udGFpbmVyID0gdGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQ7XHJcbiAgICB0aGlzLmNvbmZpZy5zdWJzY3JpYmUoY29uZmlnID0+IHtcclxuICAgICAgdGhpcy5fY29uZmlnID0gY29uZmlnO1xyXG4gICAgICBpZiAoIXRoaXMuX3N0YWdlKSB7XHJcbiAgICAgICAgdGhpcy5fc3RhZ2UgPSBuZXcgS29udmEuU3RhZ2Uoe1xyXG4gICAgICAgICAgd2lkdGg6IGNvbmZpZy53aWR0aCxcclxuICAgICAgICAgIGhlaWdodDogY29uZmlnLmhlaWdodCxcclxuICAgICAgICAgIGNvbnRhaW5lcjogbm9kZUNvbnRhaW5lclxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMudXBsb2FkS29udmEoY29uZmlnKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0aGlzLnVwbG9hZEtvbnZhKGNvbmZpZyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgbmdBZnRlckNvbnRlbnRJbml0KCkge1xyXG4gICAgdGhpcy5zaGFwZXMuZm9yRWFjaCgoaXRlbTogQ29yZVNoYXBlKSA9PiB7XHJcbiAgICAgIHRoaXMuX3N0YWdlLmFkZChpdGVtLmdldFN0YWdlKCkpO1xyXG4gICAgICB1cGRhdGVQaWN0dXJlKHRoaXMuX3N0YWdlKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgbmdPbkRlc3Ryb3koKSB7XHJcbiAgICB0aGlzLl9zdGFnZS5kZXN0cm95KCk7XHJcbiAgfVxyXG59XHJcbiIsImltcG9ydCB7IE5nTW9kdWxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IENvbW1vbk1vZHVsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XHJcbmltcG9ydCB7IFN0YWdlQ29tcG9uZW50IH0gZnJvbSAnLi9jb21wb25lbnRzL3N0YWdlLmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IENvcmVTaGFwZUNvbXBvbmVudCB9IGZyb20gJy4vY29tcG9uZW50cy9jb3JlLXNoYXBlLmNvbXBvbmVudCc7XHJcblxyXG5kZWNsYXJlIGdsb2JhbCB7XHJcbiAgaW50ZXJmYWNlIFdpbmRvdyB7IEtvbnZhOiBhbnk7IH1cclxufVxyXG5cclxuaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnICYmICF3aW5kb3cuS29udmEpIHtcclxuICByZXF1aXJlKCdrb252YScpO1xyXG59XHJcblxyXG5leHBvcnQgKiBmcm9tICcuL2NvbXBvbmVudHMvc3RhZ2UuY29tcG9uZW50JztcclxuZXhwb3J0ICogZnJvbSAnLi9jb21wb25lbnRzL2NvcmUtc2hhcGUuY29tcG9uZW50JztcclxuZXhwb3J0IHsgS29udmFDb21wb25lbnQgfSBmcm9tICcuL2tvLmludGVyZmFjZSc7XHJcblxyXG5ATmdNb2R1bGUoe1xyXG4gIGltcG9ydHM6IFtcclxuICAgIENvbW1vbk1vZHVsZVxyXG4gIF0sXHJcbiAgZGVjbGFyYXRpb25zOiBbXHJcbiAgICBTdGFnZUNvbXBvbmVudCxcclxuICAgIENvcmVTaGFwZUNvbXBvbmVudCxcclxuICBdLFxyXG4gIGV4cG9ydHM6IFtcclxuICAgIFN0YWdlQ29tcG9uZW50LFxyXG4gICAgQ29yZVNoYXBlQ29tcG9uZW50LFxyXG4gIF1cclxufSlcclxuZXhwb3J0IGNsYXNzIEtvbnZhTW9kdWxlIHtcclxufVxyXG4iXSwibmFtZXMiOlsiQ29yZVNoYXBlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFFQSx1QkFBc0MsSUFBSTtJQUN4Qyx1QkFBTSxXQUFXLEdBQUcsSUFBSSxDQUFDLFFBQVEsRUFBRSxJQUFJLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQztJQUN2RCxJQUFJLFdBQVcsRUFBRTtRQUNmLFdBQVcsQ0FBQyxTQUFTLEVBQUUsQ0FBQztLQUN6QjtDQUNGOzs7Ozs7Ozs7Ozs7QUNERCx3QkFBdUMsU0FBUyxFQUFFLEtBQUssR0FBRyxFQUFFLEVBQUUsUUFBUSxHQUFHLEVBQUU7SUFDekUsSUFBSSxJQUFJLElBQUksS0FBSyxFQUFFOztRQUVqQix1QkFBTSxPQUFPLEdBQUcsNktBQTZLLENBQUM7UUFDOUwsT0FBTyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztLQUN2QjtJQUVELHVCQUFNLFFBQVEsR0FBRyxTQUFTLENBQUMsTUFBTSxDQUFDO0lBQ2xDLHVCQUFNLFlBQVksR0FBRyxFQUFFLENBQUM7SUFDeEIscUJBQUksVUFBVSxHQUFHLEtBQUssQ0FBQztJQUV2QixNQUFNLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxHQUFHO1FBQy9CLHVCQUFNLE9BQU8sR0FBRyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsS0FBSyxJQUFJLENBQUM7UUFDekMsdUJBQU0sV0FBVyxHQUFHLFFBQVEsQ0FBQyxHQUFHLENBQUMsS0FBSyxLQUFLLENBQUMsR0FBRyxD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