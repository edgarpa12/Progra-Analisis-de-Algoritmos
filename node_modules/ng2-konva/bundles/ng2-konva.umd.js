(function (global, factory) {
    typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, require('@angular/core'), require('@angular/common')) :
    typeof define === 'function' && define.amd ? define('ng2-konva', ['exports', '@angular/core', '@angular/common'], factory) :
    (factory((global['ng2-konva'] = {}),global.ng.core,global.ng.common));
}(this, (function (exports,core,common) { 'use strict';

    /*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */
    var __assign = function () {
        __assign = Object.assign || function __assign(t) {
            for (var s, i = 1, n = arguments.length; i < n; i++) {
                s = arguments[i];
                for (var p in s)
                    if (Object.prototype.hasOwnProperty.call(s, p))
                        t[p] = s[p];
            }
            return t;
        };
        return __assign.apply(this, arguments);
    };

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes} checked by tsc
     */
    /**
     * @param {?} node
     * @return {?}
     */
    function updatePicture(node) {
        var /** @type {?} */ drawingNode = node.getLayer() || node.getStage();
        if (drawingNode) {
            drawingNode.batchDraw();
        }
    }

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes} checked by tsc
     */
    /**
     * @param {?} component
     * @param {?=} props
     * @param {?=} oldProps
     * @return {?}
     */
    function applyNodeProps(component, props, oldProps) {
        if (props === void 0) {
            props = {};
        }
        if (oldProps === void 0) {
            oldProps = {};
        }
        if ('id' in props) {
            // tslint:disable-next-line:max-line-length
            var /** @type {?} */ message = "ng2-konva: You are using \"id\" attribute for Konva node. In some very rare cases it may produce bugs. Currently we recommend not to use it and use \"name\" attribute instead.";
            console.warn(message);
        }
        var /** @type {?} */ instance = component._stage;
        var /** @type {?} */ updatedProps = {};
        var /** @type {?} */ hasUpdates = false;
        Object.keys(oldProps).forEach(function (key) {
            var /** @type {?} */ isEvent = key.slice(0, 2) === 'on';
            var /** @type {?} */ propChanged = oldProps[key] !== props[key];
            if (isEvent && propChanged) {
                var /** @type {?} */ eventName = key.substr(2).toLowerCase();
                if (eventName.substr(0, 7) === 'content') {
                    eventName =
                        'content' +
                            eventName.substr(7, 1).toUpperCase() +
                            eventName.substr(8);
                }
                instance.off(eventName, oldProps[key]);
            }
            var /** @type {?} */ toRemove = !props.hasOwnProperty(key);
            if (toRemove) {
                instance.setAttr(key, undefined);
            }
        });
        Object.keys(props).forEach(function (key) {
            var /** @type {?} */ isEvent = key.slice(0, 2) === 'on';
            var /** @type {?} */ toAdd = oldProps[key] !== props[key];
            if (isEvent && toAdd) {
                var /** @type {?} */ eventName = key.substr(2).toLowerCase();
                if (eventName.substr(0, 7) === 'content') {
                    eventName =
                        'content' +
                            eventName.substr(7, 1).toUpperCase() +
                            eventName.substr(8);
                }
                if (props[key]) {
                    instance.off(eventName);
                    instance.on(eventName, function (evt) {
                        props[key](evt.target.AngularComponent, evt);
                    });
                }
            }
            if (!isEvent &&
                (props[key] !== oldProps[key] || props[key] !== instance.getAttr(key))) {
                hasUpdates = true;
                updatedProps[key] = props[key];
            }
        });
        if (hasUpdates) {
            instance.setAttrs(updatedProps);
            updatePicture(instance);
            var /** @type {?} */ val_1;
            Object.keys(updatedProps).forEach(function (prop) {
                val_1 = updatedProps[prop];
                if (val_1 instanceof Image && !val_1.complete) {
                    var /** @type {?} */ node_1 = instance;
                    val_1.addEventListener('load', function () {
                        var /** @type {?} */ layer = node_1.getLayer();
                        if (layer) {
                            layer.batchDraw();
                        }
                    });
                }
            });
        }
    }

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes} checked by tsc
     */
    /**
     * @param {?} str
     * @return {?}
     */
    function camelize(str) {
        return str
            .replace(/(?:^\w|[A-Z]|\b\w)/g, function (letter, index) {
            return index == 0 ? letter.toLowerCase() : letter.toUpperCase();
        })
            .replace(/\s+/g, '');
    }
    /**
     * @param {?} string
     * @return {?}
     */
    function capitalizeFirstLetter(string) {
        return string.charAt(0).toUpperCase() + string.slice(1);
    }
    /**
     * @param {?} componentTag
     * @return {?}
     */
    function getName(componentTag) {
        return capitalizeFirstLetter(camelize(componentTag.substr(3).replace('-', ' ')));
    }
    /**
     * @param {?} instance
     * @return {?}
     */
    function createListener(instance) {
        var /** @type {?} */ output = {};
        [
            'click',
            'dblclick',
            'mouseover',
            'mouseout',
            'mousemove',
            'tap',
            'dbltap',
            'touchstart',
            'scaleXChange',
            'fillChange',
            'dragstart',
            'dragmove',
            'dragend',
        ].forEach(function (eventName) {
            if (instance[eventName].observers.length) {
                output['on' + eventName] = instance[eventName].emit.bind(instance[eventName]);
            }
        });
        return output;
    }

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes} checked by tsc
     */
    var CoreShapeComponent = (function () {
        function CoreShapeComponent(elementRef) {
            this.elementRef = elementRef;
            this.shapes = new core.QueryList();
            this.click = new core.EventEmitter();
            this.dblclick = new core.EventEmitter();
            this.mouseover = new core.EventEmitter();
            this.mouseout = new core.EventEmitter();
            this.mousemove = new core.EventEmitter();
            this.tap = new core.EventEmitter();
            this.dbltap = new core.EventEmitter();
            this.touchstart = new core.EventEmitter();
            this.scaleXChange = new core.EventEmitter();
            this.fillChange = new core.EventEmitter();
            this.dragstart = new core.EventEmitter();
            this.dragmove = new core.EventEmitter();
            this.dragend = new core.EventEmitter();
            this.added = false;
            this.cacheProps = {};
            this._stage = {};
            this.nameNode = getName(elementRef.nativeElement.localName);
        }
        /**
         * @return {?}
         */
        CoreShapeComponent.prototype.getStage = /**
         * @return {?}
         */
            function () {
                return this._stage;
            };
        /**
         * @return {?}
         */
        CoreShapeComponent.prototype.getConfig = /**
         * @return {?}
         */
            function () {
                return this._config || {};
            };
        /**
         * @return {?}
         */
        CoreShapeComponent.prototype.ngOnInit = /**
         * @return {?}
         */
            function () {
                this.initKonva();
            };
        /**
         * @return {?}
         */
        CoreShapeComponent.prototype.initKonva = /**
         * @return {?}
         */
            function () {
                var _this = this;
                var /** @type {?} */ ng = this;
                var /** @type {?} */ NodeClass = Konva[this.nameNode];
                this._stage = new NodeClass();
                this._stage.AngularComponent = this;
                var /** @type {?} */ animationStage = this._stage.to.bind(this._stage);
                this._stage.to = function (newConfig) {
                    animationStage(newConfig);
                    setTimeout(function () {
                        Object.keys(ng._stage.attrs).forEach(function (key) {
                            if (typeof ng._stage.attrs[key] !== 'function') {
                                ng.config[key] = ng._stage.attrs[key];
                            }
                        });
                    }, 200);
                };
                if (this.config) {
                    this.config.subscribe(function (config) {
                        _this._config = config;
                        _this.uploadKonva(config);
                    });
                }
            };
        /**
         * @param {?} config
         * @return {?}
         */
        CoreShapeComponent.prototype.uploadKonva = /**
         * @param {?} config
         * @return {?}
         */
            function (config) {
                var /** @type {?} */ props = __assign({}, config, createListener(this));
                applyNodeProps(this, props, this.cacheProps);
                this.cacheProps = props;
            };
        /**
         * @return {?}
         */
        CoreShapeComponent.prototype.ngAfterContentInit = /**
         * @return {?}
         */
            function () {
                var _this = this;
                this.shapes.forEach(function (item) {
                    if (_this !== item) {
                        item.added = true;
                        _this._stage.add(item.getStage());
                        updatePicture(_this._stage);
                    }
                });
            };
        /**
         * @return {?}
         */
        CoreShapeComponent.prototype.ngOnDestroy = /**
         * @return {?}
         */
            function () {
                this._stage.destroy();
            };
        CoreShapeComponent.decorators = [
            { type: core.Component, args: [{
                        // tslint:disable-next-line:max-line-length
                        selector: 'ko-shape, ko-layer, ko-circle, ko-fastlayer, ko-group, ko-label, ko-rect, ko-ellipse, ko-wedge, ko-line, ko-sprite, ko-image, ko-text, ko-text-path, ko-star, ko-ring, ko-arc, ko-tag, ko-path, ko-regular-polygon, ko-arrow',
                        template: "<div><ng-content></ng-content></div>"
                    },] },
        ];
        /** @nocollapse */
        CoreShapeComponent.ctorParameters = function () {
            return [
                { type: core.ElementRef }
            ];
        };
        CoreShapeComponent.propDecorators = {
            shapes: [{ type: core.ContentChildren, args: [CoreShapeComponent,] }],
            config: [{ type: core.Input }],
            click: [{ type: core.Output }],
            dblclick: [{ type: core.Output }],
            mouseover: [{ type: core.Output }],
            mouseout: [{ type: core.Output }],
            mousemove: [{ type: core.Output }],
            tap: [{ type: core.Output }],
            dbltap: [{ type: core.Output }],
            touchstart: [{ type: core.Output }],
            scaleXChange: [{ type: core.Output }],
            fillChange: [{ type: core.Output }],
            dragstart: [{ type: core.Output }],
            dragmove: [{ type: core.Output }],
            dragend: [{ type: core.Output }]
        };
        return CoreShapeComponent;
    }());

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes} checked by tsc
     */
    var StageComponent = (function () {
        function StageComponent(elementRef) {
            this.elementRef = elementRef;
            this.shapes = new core.QueryList();
            this.click = new core.EventEmitter();
            this.dblclick = new core.EventEmitter();
            this.mouseover = new core.EventEmitter();
            this.mouseout = new core.EventEmitter();
            this.mousemove = new core.EventEmitter();
            this.tap = new core.EventEmitter();
            this.dbltap = new core.EventEmitter();
            this.touchstart = new core.EventEmitter();
            this.scaleXChange = new core.EventEmitter();
            this.fillChange = new core.EventEmitter();
            this.dragstart = new core.EventEmitter();
            this.dragmove = new core.EventEmitter();
            this.dragend = new core.EventEmitter();
            this.cacheProps = {};
        }
        /**
         * @return {?}
         */
        StageComponent.prototype.getStage = /**
         * @return {?}
         */
            function () {
                return this._stage || {};
            };
        /**
         * @return {?}
         */
        StageComponent.prototype.getConfig = /**
         * @return {?}
         */
            function () {
                return this._config || {};
            };
        /**
         * @param {?} config
         * @return {?}
         */
        StageComponent.prototype.uploadKonva = /**
         * @param {?} config
         * @return {?}
         */
            function (config) {
                var /** @type {?} */ props = __assign({}, config, createListener(this));
                applyNodeProps(this, props, this.cacheProps);
                this.cacheProps = props;
            };
        /**
         * @return {?}
         */
        StageComponent.prototype.ngOnInit = /**
         * @return {?}
         */
            function () {
                var _this = this;
                var /** @type {?} */ nodeContainer = this.elementRef.nativeElement;
                this.config.subscribe(function (config) {
                    _this._config = config;
                    if (!_this._stage) {
                        _this._stage = new Konva.Stage({
                            width: config.width,
                            height: config.height,
                            container: nodeContainer
                        });
                        _this.uploadKonva(config);
                    }
                    else {
                        _this.uploadKonva(config);
                    }
                });
            };
        /**
         * @return {?}
         */
        StageComponent.prototype.ngAfterContentInit = /**
         * @return {?}
         */
            function () {
                var _this = this;
                this.shapes.forEach(function (item) {
                    _this._stage.add(item.getStage());
                    updatePicture(_this._stage);
                });
            };
        /**
         * @return {?}
         */
        StageComponent.prototype.ngOnDestroy = /**
         * @return {?}
         */
            function () {
                this._stage.destroy();
            };
        StageComponent.decorators = [
            { type: core.Component, args: [{
                        selector: 'ko-stage',
                        template: "<div><ng-content></ng-content>{{config}}</div>"
                    },] },
        ];
        /** @nocollapse */
        StageComponent.ctorParameters = function () {
            return [
                { type: core.ElementRef }
            ];
        };
        StageComponent.propDecorators = {
            shapes: [{ type: core.ContentChildren, args: [CoreShapeComponent,] }],
            config: [{ type: core.Input }],
            click: [{ type: core.Output }],
            dblclick: [{ type: core.Output }],
            mouseover: [{ type: core.Output }],
            mouseout: [{ type: core.Output }],
            mousemove: [{ type: core.Output }],
            tap: [{ type: core.Output }],
            dbltap: [{ type: core.Output }],
            touchstart: [{ type: core.Output }],
            scaleXChange: [{ type: core.Output }],
            fillChange: [{ type: core.Output }],
            dragstart: [{ type: core.Output }],
            dragmove: [{ type: core.Output }],
            dragend: [{ type: core.Output }]
        };
        return StageComponent;
    }());

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes} checked by tsc
     */
    if (typeof window !== 'undefined' && !window.Konva) {
        require('konva');
    }
    var KonvaModule = (function () {
        function KonvaModule() {
        }
        KonvaModule.decorators = [
            { type: core.NgModule, args: [{
                        imports: [
                            common.CommonModule
                        ],
                        declarations: [
                            StageComponent,
                            CoreShapeComponent,
                        ],
                        exports: [
                            StageComponent,
                            CoreShapeComponent,
                        ]
                    },] },
        ];
        return KonvaModule;
    }());

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes} checked by tsc
     */

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes} checked by tsc
     */

    exports.KonvaModule = KonvaModule;
    exports.StageComponent = StageComponent;
    exports.CoreShapeComponent = CoreShapeComponent;

    Object.defineProperty(exports, '__esModule', { value: true });

})));

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmcyLWtvbnZhLnVtZC5qcy5tYXAiLCJzb3VyY2VzIjpbbnVsbCwibmc6Ly9uZzIta29udmEvbGliL3V0aWxzL3VwZGF0ZVBpY3R1cmUudHMiLCJuZzovL25nMi1rb252YS9saWIvdXRpbHMvYXBwbHlOb2RlUHJvcHMudHMiLCJuZzovL25nMi1rb252YS9saWIvdXRpbHMvaW5kZXgudHMiLCJuZzovL25nMi1rb252YS9saWIvY29tcG9uZW50cy9jb3JlLXNoYXBlLmNvbXBvbmVudC50cyIsIm5nOi8vbmcyLWtvbnZhL2xpYi9jb21wb25lbnRzL3N0YWdlLmNvbXBvbmVudC50cyIsIm5nOi8vbmcyLWtvbnZhL2xpYi9rb252YS5tb2R1bGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyohICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXHJcbkNvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxyXG5MaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpOyB5b3UgbWF5IG5vdCB1c2VcclxudGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGVcclxuTGljZW5zZSBhdCBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuXHJcblRISVMgQ09ERSBJUyBQUk9WSURFRCBPTiBBTiAqQVMgSVMqIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTllcclxuS0lORCwgRUlUSEVSIEVYUFJFU1MgT1IgSU1QTElFRCwgSU5DTFVESU5HIFdJVEhPVVQgTElNSVRBVElPTiBBTlkgSU1QTElFRFxyXG5XQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgVElUTEUsIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLFxyXG5NRVJDSEFOVEFCTElUWSBPUiBOT04tSU5GUklOR0VNRU5ULlxyXG5cclxuU2VlIHRoZSBBcGFjaGUgVmVyc2lvbiAyLjAgTGljZW5zZSBmb3Igc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zXHJcbmFuZCBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiogKi9cclxuLyogZ2xvYmFsIFJlZmxlY3QsIFByb21pc2UgKi9cclxuXHJcbnZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24oZCwgYikge1xyXG4gICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxyXG4gICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcclxuICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTtcclxuICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpO1xyXG59O1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fZXh0ZW5kcyhkLCBiKSB7XHJcbiAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xyXG4gICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XHJcbiAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XHJcbn1cclxuXHJcbmV4cG9ydCB2YXIgX19hc3NpZ24gPSBmdW5jdGlvbigpIHtcclxuICAgIF9fYXNzaWduID0gT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbiBfX2Fzc2lnbih0KSB7XHJcbiAgICAgICAgZm9yICh2YXIgcywgaSA9IDEsIG4gPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7XHJcbiAgICAgICAgICAgIHMgPSBhcmd1bWVudHNbaV07XHJcbiAgICAgICAgICAgIGZvciAodmFyIHAgaW4gcykgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzLCBwKSkgdFtwXSA9IHNbcF07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0O1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIF9fYXNzaWduLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX3Jlc3QocywgZSkge1xyXG4gICAgdmFyIHQgPSB7fTtcclxuICAgIGZvciAodmFyIHAgaW4gcykgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzLCBwKSAmJiBlLmluZGV4T2YocCkgPCAwKVxyXG4gICAgICAgIHRbcF0gPSBzW3BdO1xyXG4gICAgaWYgKHMgIT0gbnVsbCAmJiB0eXBlb2YgT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyA9PT0gXCJmdW5jdGlvblwiKVxyXG4gICAgICAgIGZvciAodmFyIGkgPSAwLCBwID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhzKTsgaSA8IHAubGVuZ3RoOyBpKyspIGlmIChlLmluZGV4T2YocFtpXSkgPCAwKVxyXG4gICAgICAgICAgICB0W3BbaV1dID0gc1twW2ldXTtcclxuICAgIHJldHVybiB0O1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19kZWNvcmF0ZShkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYykge1xyXG4gICAgdmFyIGMgPSBhcmd1bWVudHMubGVuZ3RoLCByID0gYyA8IDMgPyB0YXJnZXQgOiBkZXNjID09PSBudWxsID8gZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IodGFyZ2V0LCBrZXkpIDogZGVzYywgZDtcclxuICAgIGlmICh0eXBlb2YgUmVmbGVjdCA9PT0gXCJvYmplY3RcIiAmJiB0eXBlb2YgUmVmbGVjdC5kZWNvcmF0ZSA9PT0gXCJmdW5jdGlvblwiKSByID0gUmVmbGVjdC5kZWNvcmF0ZShkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYyk7XHJcbiAgICBlbHNlIGZvciAodmFyIGkgPSBkZWNvcmF0b3JzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSBpZiAoZCA9IGRlY29yYXRvcnNbaV0pIHIgPSAoYyA8IDMgPyBkKHIpIDogYyA+IDMgPyBkKHRhcmdldCwga2V5LCByKSA6IGQodGFyZ2V0LCBrZXkpKSB8fCByO1xyXG4gICAgcmV0dXJuIGMgPiAzICYmIHIgJiYgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCByKSwgcjtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fcGFyYW0ocGFyYW1JbmRleCwgZGVjb3JhdG9yKSB7XHJcbiAgICByZXR1cm4gZnVuY3Rpb24gKHRhcmdldCwga2V5KSB7IGRlY29yYXRvcih0YXJnZXQsIGtleSwgcGFyYW1JbmRleCk7IH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fbWV0YWRhdGEobWV0YWRhdGFLZXksIG1ldGFkYXRhVmFsdWUpIHtcclxuICAgIGlmICh0eXBlb2YgUmVmbGVjdCA9PT0gXCJvYmplY3RcIiAmJiB0eXBlb2YgUmVmbGVjdC5tZXRhZGF0YSA9PT0gXCJmdW5jdGlvblwiKSByZXR1cm4gUmVmbGVjdC5tZXRhZGF0YShtZXRhZGF0YUtleSwgbWV0YWRhdGFWYWx1ZSk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2F3YWl0ZXIodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XHJcbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XHJcbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XHJcbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHJlc3VsdC52YWx1ZSk7IH0pLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cclxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XHJcbiAgICB9KTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fZ2VuZXJhdG9yKHRoaXNBcmcsIGJvZHkpIHtcclxuICAgIHZhciBfID0geyBsYWJlbDogMCwgc2VudDogZnVuY3Rpb24oKSB7IGlmICh0WzBdICYgMSkgdGhyb3cgdFsxXTsgcmV0dXJuIHRbMV07IH0sIHRyeXM6IFtdLCBvcHM6IFtdIH0sIGYsIHksIHQsIGc7XHJcbiAgICByZXR1cm4gZyA9IHsgbmV4dDogdmVyYigwKSwgXCJ0aHJvd1wiOiB2ZXJiKDEpLCBcInJldHVyblwiOiB2ZXJiKDIpIH0sIHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiAoZ1tTeW1ib2wuaXRlcmF0b3JdID0gZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzOyB9KSwgZztcclxuICAgIGZ1bmN0aW9uIHZlcmIobikgeyByZXR1cm4gZnVuY3Rpb24gKHYpIHsgcmV0dXJuIHN0ZXAoW24sIHZdKTsgfTsgfVxyXG4gICAgZnVuY3Rpb24gc3RlcChvcCkge1xyXG4gICAgICAgIGlmIChmKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiR2VuZXJhdG9yIGlzIGFscmVhZHkgZXhlY3V0aW5nLlwiKTtcclxuICAgICAgICB3aGlsZSAoXykgdHJ5IHtcclxuICAgICAgICAgICAgaWYgKGYgPSAxLCB5ICYmICh0ID0gb3BbMF0gJiAyID8geVtcInJldHVyblwiXSA6IG9wWzBdID8geVtcInRocm93XCJdIHx8ICgodCA9IHlbXCJyZXR1cm5cIl0pICYmIHQuY2FsbCh5KSwgMCkgOiB5Lm5leHQpICYmICEodCA9IHQuY2FsbCh5LCBvcFsxXSkpLmRvbmUpIHJldHVybiB0O1xyXG4gICAgICAgICAgICBpZiAoeSA9IDAsIHQpIG9wID0gW29wWzBdICYgMiwgdC52YWx1ZV07XHJcbiAgICAgICAgICAgIHN3aXRjaCAob3BbMF0pIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgMDogY2FzZSAxOiB0ID0gb3A7IGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSA0OiBfLmxhYmVsKys7IHJldHVybiB7IHZhbHVlOiBvcFsxXSwgZG9uZTogZmFsc2UgfTtcclxuICAgICAgICAgICAgICAgIGNhc2UgNTogXy5sYWJlbCsrOyB5ID0gb3BbMV07IG9wID0gWzBdOyBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgIGNhc2UgNzogb3AgPSBfLm9wcy5wb3AoKTsgXy50cnlzLnBvcCgpOyBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEodCA9IF8udHJ5cywgdCA9IHQubGVuZ3RoID4gMCAmJiB0W3QubGVuZ3RoIC0gMV0pICYmIChvcFswXSA9PT0gNiB8fCBvcFswXSA9PT0gMikpIHsgXyA9IDA7IGNvbnRpbnVlOyB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wWzBdID09PSAzICYmICghdCB8fCAob3BbMV0gPiB0WzBdICYmIG9wWzFdIDwgdFszXSkpKSB7IF8ubGFiZWwgPSBvcFsxXTsgYnJlYWs7IH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAob3BbMF0gPT09IDYgJiYgXy5sYWJlbCA8IHRbMV0pIHsgXy5sYWJlbCA9IHRbMV07IHQgPSBvcDsgYnJlYWs7IH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAodCAmJiBfLmxhYmVsIDwgdFsyXSkgeyBfLmxhYmVsID0gdFsyXTsgXy5vcHMucHVzaChvcCk7IGJyZWFrOyB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRbMl0pIF8ub3BzLnBvcCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIF8udHJ5cy5wb3AoKTsgY29udGludWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgb3AgPSBib2R5LmNhbGwodGhpc0FyZywgXyk7XHJcbiAgICAgICAgfSBjYXRjaCAoZSkgeyBvcCA9IFs2LCBlXTsgeSA9IDA7IH0gZmluYWxseSB7IGYgPSB0ID0gMDsgfVxyXG4gICAgICAgIGlmIChvcFswXSAmIDUpIHRocm93IG9wWzFdOyByZXR1cm4geyB2YWx1ZTogb3BbMF0gPyBvcFsxXSA6IHZvaWQgMCwgZG9uZTogdHJ1ZSB9O1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19leHBvcnRTdGFyKG0sIGV4cG9ydHMpIHtcclxuICAgIGZvciAodmFyIHAgaW4gbSkgaWYgKCFleHBvcnRzLmhhc093blByb3BlcnR5KHApKSBleHBvcnRzW3BdID0gbVtwXTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fdmFsdWVzKG8pIHtcclxuICAgIHZhciBtID0gdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIG9bU3ltYm9sLml0ZXJhdG9yXSwgaSA9IDA7XHJcbiAgICBpZiAobSkgcmV0dXJuIG0uY2FsbChvKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgbmV4dDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBpZiAobyAmJiBpID49IG8ubGVuZ3RoKSBvID0gdm9pZCAwO1xyXG4gICAgICAgICAgICByZXR1cm4geyB2YWx1ZTogbyAmJiBvW2krK10sIGRvbmU6ICFvIH07XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fcmVhZChvLCBuKSB7XHJcbiAgICB2YXIgbSA9IHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiBvW1N5bWJvbC5pdGVyYXRvcl07XHJcbiAgICBpZiAoIW0pIHJldHVybiBvO1xyXG4gICAgdmFyIGkgPSBtLmNhbGwobyksIHIsIGFyID0gW10sIGU7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIHdoaWxlICgobiA9PT0gdm9pZCAwIHx8IG4tLSA+IDApICYmICEociA9IGkubmV4dCgpKS5kb25lKSBhci5wdXNoKHIudmFsdWUpO1xyXG4gICAgfVxyXG4gICAgY2F0Y2ggKGVycm9yKSB7IGUgPSB7IGVycm9yOiBlcnJvciB9OyB9XHJcbiAgICBmaW5hbGx5IHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBpZiAociAmJiAhci5kb25lICYmIChtID0gaVtcInJldHVyblwiXSkpIG0uY2FsbChpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZmluYWxseSB7IGlmIChlKSB0aHJvdyBlLmVycm9yOyB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gYXI7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX3NwcmVhZCgpIHtcclxuICAgIGZvciAodmFyIGFyID0gW10sIGkgPSAwOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKVxyXG4gICAgICAgIGFyID0gYXIuY29uY2F0KF9fcmVhZChhcmd1bWVudHNbaV0pKTtcclxuICAgIHJldHVybiBhcjtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fYXdhaXQodikge1xyXG4gICAgcmV0dXJuIHRoaXMgaW5zdGFuY2VvZiBfX2F3YWl0ID8gKHRoaXMudiA9IHYsIHRoaXMpIDogbmV3IF9fYXdhaXQodik7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2FzeW5jR2VuZXJhdG9yKHRoaXNBcmcsIF9hcmd1bWVudHMsIGdlbmVyYXRvcikge1xyXG4gICAgaWYgKCFTeW1ib2wuYXN5bmNJdGVyYXRvcikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlN5bWJvbC5hc3luY0l0ZXJhdG9yIGlzIG5vdCBkZWZpbmVkLlwiKTtcclxuICAgIHZhciBnID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pLCBpLCBxID0gW107XHJcbiAgICByZXR1cm4gaSA9IHt9LCB2ZXJiKFwibmV4dFwiKSwgdmVyYihcInRocm93XCIpLCB2ZXJiKFwicmV0dXJuXCIpLCBpW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXM7IH0sIGk7XHJcbiAgICBmdW5jdGlvbiB2ZXJiKG4pIHsgaWYgKGdbbl0pIGlbbl0gPSBmdW5jdGlvbiAodikgeyByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKGEsIGIpIHsgcS5wdXNoKFtuLCB2LCBhLCBiXSkgPiAxIHx8IHJlc3VtZShuLCB2KTsgfSk7IH07IH1cclxuICAgIGZ1bmN0aW9uIHJlc3VtZShuLCB2KSB7IHRyeSB7IHN0ZXAoZ1tuXSh2KSk7IH0gY2F0Y2ggKGUpIHsgc2V0dGxlKHFbMF1bM10sIGUpOyB9IH1cclxuICAgIGZ1bmN0aW9uIHN0ZXAocikgeyByLnZhbHVlIGluc3RhbmNlb2YgX19hd2FpdCA/IFByb21pc2UucmVzb2x2ZShyLnZhbHVlLnYpLnRoZW4oZnVsZmlsbCwgcmVqZWN0KSA6IHNldHRsZShxWzBdWzJdLCByKTsgfVxyXG4gICAgZnVuY3Rpb24gZnVsZmlsbCh2YWx1ZSkgeyByZXN1bWUoXCJuZXh0XCIsIHZhbHVlKTsgfVxyXG4gICAgZnVuY3Rpb24gcmVqZWN0KHZhbHVlKSB7IHJlc3VtZShcInRocm93XCIsIHZhbHVlKTsgfVxyXG4gICAgZnVuY3Rpb24gc2V0dGxlKGYsIHYpIHsgaWYgKGYodiksIHEuc2hpZnQoKSwgcS5sZW5ndGgpIHJlc3VtZShxWzBdWzBdLCBxWzBdWzFdKTsgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19hc3luY0RlbGVnYXRvcihvKSB7XHJcbiAgICB2YXIgaSwgcDtcclxuICAgIHJldHVybiBpID0ge30sIHZlcmIoXCJuZXh0XCIpLCB2ZXJiKFwidGhyb3dcIiwgZnVuY3Rpb24gKGUpIHsgdGhyb3cgZTsgfSksIHZlcmIoXCJyZXR1cm5cIiksIGlbU3ltYm9sLml0ZXJhdG9yXSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXM7IH0sIGk7XHJcbiAgICBmdW5jdGlvbiB2ZXJiKG4sIGYpIHsgaVtuXSA9IG9bbl0gPyBmdW5jdGlvbiAodikgeyByZXR1cm4gKHAgPSAhcCkgPyB7IHZhbHVlOiBfX2F3YWl0KG9bbl0odikpLCBkb25lOiBuID09PSBcInJldHVyblwiIH0gOiBmID8gZih2KSA6IHY7IH0gOiBmOyB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2FzeW5jVmFsdWVzKG8pIHtcclxuICAgIGlmICghU3ltYm9sLmFzeW5jSXRlcmF0b3IpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJTeW1ib2wuYXN5bmNJdGVyYXRvciBpcyBub3QgZGVmaW5lZC5cIik7XHJcbiAgICB2YXIgbSA9IG9bU3ltYm9sLmFzeW5jSXRlcmF0b3JdLCBpO1xyXG4gICAgcmV0dXJuIG0gPyBtLmNhbGwobykgOiAobyA9IHR5cGVvZiBfX3ZhbHVlcyA9PT0gXCJmdW5jdGlvblwiID8gX192YWx1ZXMobykgOiBvW1N5bWJvbC5pdGVyYXRvcl0oKSwgaSA9IHt9LCB2ZXJiKFwibmV4dFwiKSwgdmVyYihcInRocm93XCIpLCB2ZXJiKFwicmV0dXJuXCIpLCBpW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXM7IH0sIGkpO1xyXG4gICAgZnVuY3Rpb24gdmVyYihuKSB7IGlbbl0gPSBvW25dICYmIGZ1bmN0aW9uICh2KSB7IHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7IHYgPSBvW25dKHYpLCBzZXR0bGUocmVzb2x2ZSwgcmVqZWN0LCB2LmRvbmUsIHYudmFsdWUpOyB9KTsgfTsgfVxyXG4gICAgZnVuY3Rpb24gc2V0dGxlKHJlc29sdmUsIHJlamVjdCwgZCwgdikgeyBQcm9taXNlLnJlc29sdmUodikudGhlbihmdW5jdGlvbih2KSB7IHJlc29sdmUoeyB2YWx1ZTogdiwgZG9uZTogZCB9KTsgfSwgcmVqZWN0KTsgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19tYWtlVGVtcGxhdGVPYmplY3QoY29va2VkLCByYXcpIHtcclxuICAgIGlmIChPYmplY3QuZGVmaW5lUHJvcGVydHkpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KGNvb2tlZCwgXCJyYXdcIiwgeyB2YWx1ZTogcmF3IH0pOyB9IGVsc2UgeyBjb29rZWQucmF3ID0gcmF3OyB9XHJcbiAgICByZXR1cm4gY29va2VkO1xyXG59O1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9faW1wb3J0U3Rhcihtb2QpIHtcclxuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XHJcbiAgICB2YXIgcmVzdWx0ID0ge307XHJcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoT2JqZWN0Lmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgcmVzdWx0W2tdID0gbW9kW2tdO1xyXG4gICAgcmVzdWx0LmRlZmF1bHQgPSBtb2Q7XHJcbiAgICByZXR1cm4gcmVzdWx0O1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19pbXBvcnREZWZhdWx0KG1vZCkge1xyXG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBkZWZhdWx0OiBtb2QgfTtcclxufVxyXG4iLCIvLyBhZGFwdGVkIEZST006IGh0dHBzOi8vZ2l0aHViLmNvbS9sYXZydG9uL3JlYWN0LWtvbnZhL2Jsb2IvbWFzdGVyL3NyYy9yZWFjdC1rb252YS1maWJlci5qc1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gdXBkYXRlUGljdHVyZShub2RlKSB7XHJcbiAgY29uc3QgZHJhd2luZ05vZGUgPSBub2RlLmdldExheWVyKCkgfHwgbm9kZS5nZXRTdGFnZSgpO1xyXG4gIGlmIChkcmF3aW5nTm9kZSkge1xyXG4gICAgZHJhd2luZ05vZGUuYmF0Y2hEcmF3KCk7XHJcbiAgfVxyXG59XHJcbiIsIi8vIGFkYXB0ZWQgRlJPTTogaHR0cHM6Ly9naXRodWIuY29tL2xhdnJ0b24vcmVhY3Qta29udmEvYmxvYi9tYXN0ZXIvc3JjL3JlYWN0LWtvbnZhLWZpYmVyLmpzXHJcblxyXG5pbXBvcnQgdXBkYXRlUGljdHVyZSBmcm9tICcuL3VwZGF0ZVBpY3R1cmUnO1xyXG5cclxuZGVjbGFyZSBjb25zdCBJbWFnZTogYW55O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gYXBwbHlOb2RlUHJvcHMoY29tcG9uZW50LCBwcm9wcyA9IHt9LCBvbGRQcm9wcyA9IHt9KSB7XHJcbiAgaWYgKCdpZCcgaW4gcHJvcHMpIHtcclxuICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTptYXgtbGluZS1sZW5ndGhcclxuICAgIGNvbnN0IG1lc3NhZ2UgPSBgbmcyLWtvbnZhOiBZb3UgYXJlIHVzaW5nIFwiaWRcIiBhdHRyaWJ1dGUgZm9yIEtvbnZhIG5vZGUuIEluIHNvbWUgdmVyeSByYXJlIGNhc2VzIGl0IG1heSBwcm9kdWNlIGJ1Z3MuIEN1cnJlbnRseSB3ZSByZWNvbW1lbmQgbm90IHRvIHVzZSBpdCBhbmQgdXNlIFwibmFtZVwiIGF0dHJpYnV0ZSBpbnN0ZWFkLmA7XHJcbiAgICBjb25zb2xlLndhcm4obWVzc2FnZSk7XHJcbiAgfVxyXG5cclxuICBjb25zdCBpbnN0YW5jZSA9IGNvbXBvbmVudC5fc3RhZ2U7XHJcbiAgY29uc3QgdXBkYXRlZFByb3BzID0ge307XHJcbiAgbGV0IGhhc1VwZGF0ZXMgPSBmYWxzZTtcclxuXHJcbiAgT2JqZWN0LmtleXMob2xkUHJvcHMpLmZvckVhY2goa2V5ID0+IHtcclxuICAgIGNvbnN0IGlzRXZlbnQgPSBrZXkuc2xpY2UoMCwgMikgPT09ICdvbic7XHJcbiAgICBjb25zdCBwcm9wQ2hhbmdlZCA9IG9sZFByb3BzW2tleV0gIT09IHByb3BzW2tleV07XHJcbiAgICBpZiAoaXNFdmVudCAmJiBwcm9wQ2hhbmdlZCkge1xyXG4gICAgICBsZXQgZXZlbnROYW1lID0ga2V5LnN1YnN0cigyKS50b0xvd2VyQ2FzZSgpO1xyXG4gICAgICBpZiAoZXZlbnROYW1lLnN1YnN0cigwLCA3KSA9PT0gJ2NvbnRlbnQnKSB7XHJcbiAgICAgICAgZXZlbnROYW1lID1cclxuICAgICAgICAgICdjb250ZW50JyArXHJcbiAgICAgICAgICBldmVudE5hbWUuc3Vic3RyKDcsIDEpLnRvVXBwZXJDYXNlKCkgK1xyXG4gICAgICAgICAgZXZlbnROYW1lLnN1YnN0cig4KTtcclxuICAgICAgfVxyXG4gICAgICBpbnN0YW5jZS5vZmYoZXZlbnROYW1lLCBvbGRQcm9wc1trZXldKTtcclxuICAgIH1cclxuICAgIGNvbnN0IHRvUmVtb3ZlID0gIXByb3BzLmhhc093blByb3BlcnR5KGtleSk7XHJcbiAgICBpZiAodG9SZW1vdmUpIHtcclxuICAgICAgaW5zdGFuY2Uuc2V0QXR0cihrZXksIHVuZGVmaW5lZCk7XHJcbiAgICB9XHJcbiAgfSk7XHJcbiAgT2JqZWN0LmtleXMocHJvcHMpLmZvckVhY2goa2V5ID0+IHtcclxuICAgIGxldCBpc0V2ZW50ID0ga2V5LnNsaWNlKDAsIDIpID09PSAnb24nO1xyXG4gICAgY29uc3QgdG9BZGQgPSBvbGRQcm9wc1trZXldICE9PSBwcm9wc1trZXldO1xyXG4gICAgaWYgKGlzRXZlbnQgJiYgdG9BZGQpIHtcclxuICAgICAgbGV0IGV2ZW50TmFtZSA9IGtleS5zdWJzdHIoMikudG9Mb3dlckNhc2UoKTtcclxuICAgICAgaWYgKGV2ZW50TmFtZS5zdWJzdHIoMCwgNykgPT09ICdjb250ZW50Jykge1xyXG4gICAgICAgIGV2ZW50TmFtZSA9XHJcbiAgICAgICAgICAnY29udGVudCcgK1xyXG4gICAgICAgICAgZXZlbnROYW1lLnN1YnN0cig3LCAxKS50b1VwcGVyQ2FzZSgpICtcclxuICAgICAgICAgIGV2ZW50TmFtZS5zdWJzdHIoOCk7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKHByb3BzW2tleV0pIHtcclxuICAgICAgICBpbnN0YW5jZS5vZmYoZXZlbnROYW1lKTtcclxuICAgICAgICBpbnN0YW5jZS5vbihldmVudE5hbWUsIGV2dCA9PiB7XHJcbiAgICAgICAgICBwcm9wc1trZXldKGV2dC50YXJnZXQuQW5ndWxhckNvbXBvbmVudCwgZXZ0KTtcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYgKFxyXG4gICAgICAhaXNFdmVudCAmJlxyXG4gICAgICAocHJvcHNba2V5XSAhPT0gb2xkUHJvcHNba2V5XSB8fCBwcm9wc1trZXldICE9PSBpbnN0YW5jZS5nZXRBdHRyKGtleSkpXHJcbiAgICApIHtcclxuICAgICAgaGFzVXBkYXRlcyA9IHRydWU7XHJcbiAgICAgIHVwZGF0ZWRQcm9wc1trZXldID0gcHJvcHNba2V5XTtcclxuICAgIH1cclxuICB9KTtcclxuXHJcbiAgaWYgKGhhc1VwZGF0ZXMpIHtcclxuICAgIGluc3RhbmNlLnNldEF0dHJzKHVwZGF0ZWRQcm9wcyk7XHJcbiAgICB1cGRhdGVQaWN0dXJlKGluc3RhbmNlKTtcclxuICAgIGxldCB2YWw7XHJcbiAgICBPYmplY3Qua2V5cyh1cGRhdGVkUHJvcHMpLmZvckVhY2gocHJvcCA9PiB7XHJcbiAgICAgIHZhbCA9IHVwZGF0ZWRQcm9wc1twcm9wXTtcclxuICAgICAgaWYgKHZhbCBpbnN0YW5jZW9mIEltYWdlICYmICF2YWwuY29tcGxldGUpIHtcclxuICAgICAgICBjb25zdCBub2RlID0gaW5zdGFuY2U7XHJcbiAgICAgICAgdmFsLmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgIGNvbnN0IGxheWVyID0gbm9kZS5nZXRMYXllcigpO1xyXG4gICAgICAgICAgaWYgKGxheWVyKSB7XHJcbiAgICAgICAgICAgIGxheWVyLmJhdGNoRHJhdygpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcbn1cclxuIiwiaW1wb3J0IHVwZGF0ZVBpY3R1cmUgZnJvbSAnLi91cGRhdGVQaWN0dXJlJztcclxuaW1wb3J0IGFwcGx5Tm9kZVByb3BzIGZyb20gJy4vYXBwbHlOb2RlUHJvcHMnO1xyXG5cclxuZnVuY3Rpb24gY2FtZWxpemUoc3RyKSB7XHJcbiAgcmV0dXJuIHN0clxyXG4gICAgLnJlcGxhY2UoLyg/Ol5cXHd8W0EtWl18XFxiXFx3KS9nLCBmdW5jdGlvbihsZXR0ZXIsIGluZGV4KSB7XHJcbiAgICAgIHJldHVybiBpbmRleCA9PSAwID8gbGV0dGVyLnRvTG93ZXJDYXNlKCkgOiBsZXR0ZXIudG9VcHBlckNhc2UoKTtcclxuICAgIH0pXHJcbiAgICAucmVwbGFjZSgvXFxzKy9nLCAnJyk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNhcGl0YWxpemVGaXJzdExldHRlcihzdHJpbmcpIHtcclxuICByZXR1cm4gc3RyaW5nLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgc3RyaW5nLnNsaWNlKDEpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0TmFtZShjb21wb25lbnRUYWcpIHtcclxuICByZXR1cm4gY2FwaXRhbGl6ZUZpcnN0TGV0dGVyKGNhbWVsaXplKGNvbXBvbmVudFRhZy5zdWJzdHIoMykucmVwbGFjZSgnLScsICcgJykpKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZUxpc3RlbmVyKGluc3RhbmNlOiBhbnkpIHtcclxuICBjb25zdCBvdXRwdXQgPSB7fTtcclxuICBbXHJcbiAgICAnY2xpY2snLFxyXG4gICAgJ2RibGNsaWNrJyxcclxuICAgICdtb3VzZW92ZXInLFxyXG4gICAgJ21vdXNlb3V0JyxcclxuICAgICdtb3VzZW1vdmUnLFxyXG4gICAgJ3RhcCcsXHJcbiAgICAnZGJsdGFwJyxcclxuICAgICd0b3VjaHN0YXJ0JyxcclxuICAgICdzY2FsZVhDaGFuZ2UnLFxyXG4gICAgJ2ZpbGxDaGFuZ2UnLFxyXG4gICAgJ2RyYWdzdGFydCcsXHJcbiAgICAnZHJhZ21vdmUnLFxyXG4gICAgJ2RyYWdlbmQnLFxyXG4gIF0uZm9yRWFjaChldmVudE5hbWUgPT4ge1xyXG4gICAgaWYgKGluc3RhbmNlW2V2ZW50TmFtZV0ub2JzZXJ2ZXJzLmxlbmd0aCkge1xyXG4gICAgICBvdXRwdXRbJ29uJyArIGV2ZW50TmFtZV0gPSBpbnN0YW5jZVtldmVudE5hbWVdLmVtaXQuYmluZChcclxuICAgICAgICBpbnN0YW5jZVtldmVudE5hbWVdXHJcbiAgICAgICk7XHJcbiAgICB9XHJcbiAgfSk7XHJcbiAgcmV0dXJuIG91dHB1dDtcclxufVxyXG5cclxuZXhwb3J0IHsgdXBkYXRlUGljdHVyZSwgYXBwbHlOb2RlUHJvcHMgfTtcclxuIiwiaW1wb3J0IHtcclxuICBDb21wb25lbnQsXHJcbiAgSW5wdXQsXHJcbiAgT3V0cHV0LFxyXG4gIEV2ZW50RW1pdHRlcixcclxuICBFbGVtZW50UmVmLFxyXG4gIEFmdGVyQ29udGVudEluaXQsXHJcbiAgQ29udGVudENoaWxkcmVuLFxyXG4gIFF1ZXJ5TGlzdCxcclxuICBPbkRlc3Ryb3ksXHJcbiAgT25Jbml0LFxyXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7XHJcbiAgZ2V0TmFtZSxcclxuICBjcmVhdGVMaXN0ZW5lcixcclxuICBhcHBseU5vZGVQcm9wcyxcclxuICB1cGRhdGVQaWN0dXJlXHJcbn0gZnJvbSAnLi4vdXRpbHMvaW5kZXgnO1xyXG5pbXBvcnQgeyBLb252YUNvbXBvbmVudCB9IGZyb20gJy4uL2tvLmludGVyZmFjZSc7XHJcblxyXG5kZWNsYXJlIGNvbnN0IEtvbnZhOiBhbnk7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bWF4LWxpbmUtbGVuZ3RoXHJcbiAgc2VsZWN0b3I6XHJcbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bWF4LWxpbmUtbGVuZ3RoXHJcbiAgICAna28tc2hhcGUsIGtvLWxheWVyLCBrby1jaXJjbGUsIGtvLWZhc3RsYXllciwga28tZ3JvdXAsIGtvLWxhYmVsLCBrby1yZWN0LCBrby1lbGxpcHNlLCBrby13ZWRnZSwga28tbGluZSwga28tc3ByaXRlLCBrby1pbWFnZSwga28tdGV4dCwga28tdGV4dC1wYXRoLCBrby1zdGFyLCBrby1yaW5nLCBrby1hcmMsIGtvLXRhZywga28tcGF0aCwga28tcmVndWxhci1wb2x5Z29uLCBrby1hcnJvdycsXHJcbiAgdGVtcGxhdGU6IGA8ZGl2PjxuZy1jb250ZW50PjwvbmctY29udGVudD48L2Rpdj5gXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBDb3JlU2hhcGVDb21wb25lbnRcclxuICBpbXBsZW1lbnRzIEtvbnZhQ29tcG9uZW50LCBBZnRlckNvbnRlbnRJbml0LCBPbkRlc3Ryb3ksIE9uSW5pdCB7XHJcbiAgQENvbnRlbnRDaGlsZHJlbihDb3JlU2hhcGVDb21wb25lbnQpXHJcbiAgc2hhcGVzID0gbmV3IFF1ZXJ5TGlzdDxDb3JlU2hhcGVDb21wb25lbnQ+KCk7XHJcbiAgQElucHV0KCkgY29uZmlnOiBPYnNlcnZhYmxlPGFueT47XHJcbiAgQE91dHB1dCgpIGNsaWNrOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICBAT3V0cHV0KCkgZGJsY2xpY2s6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gIEBPdXRwdXQoKSBtb3VzZW92ZXI6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gIEBPdXRwdXQoKSBtb3VzZW91dDogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgQE91dHB1dCgpIG1vdXNlbW92ZTogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgQE91dHB1dCgpIHRhcDogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgQE91dHB1dCgpIGRibHRhcDogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgQE91dHB1dCgpIHRvdWNoc3RhcnQ6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gIEBPdXRwdXQoKSBzY2FsZVhDaGFuZ2U6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gIEBPdXRwdXQoKSBmaWxsQ2hhbmdlOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICBAT3V0cHV0KCkgZHJhZ3N0YXJ0OiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICBAT3V0cHV0KCkgZHJhZ21vdmU6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gIEBPdXRwdXQoKSBkcmFnZW5kOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuXHJcbiAgcHVibGljIG5hbWVOb2RlOiBzdHJpbmc7XHJcbiAgcHVibGljIGFkZGVkID0gZmFsc2U7XHJcblxyXG4gIHByaXZhdGUgY2FjaGVQcm9wczogYW55ID0ge307XHJcbiAgcHJpdmF0ZSBfc3RhZ2U6IGFueSA9IHt9O1xyXG4gIHByaXZhdGUgX2NvbmZpZztcclxuXHJcbiAgcHVibGljIGdldFN0YWdlKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuX3N0YWdlO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldENvbmZpZygpIHtcclxuICAgIHJldHVybiB0aGlzLl9jb25maWcgfHwge307XHJcbiAgfVxyXG5cclxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGVsZW1lbnRSZWY6IEVsZW1lbnRSZWYpIHtcclxuICAgIHRoaXMubmFtZU5vZGUgPSBnZXROYW1lKGVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5sb2NhbE5hbWUpO1xyXG4gIH1cclxuXHJcbiAgbmdPbkluaXQoKSB7XHJcbiAgICB0aGlzLmluaXRLb252YSgpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBpbml0S29udmEoKSB7XHJcbiAgICBjb25zdCBuZyA9IHRoaXM7XHJcbiAgICBjb25zdCBOb2RlQ2xhc3MgPSBLb252YVt0aGlzLm5hbWVOb2RlXTtcclxuICAgIHRoaXMuX3N0YWdlID0gbmV3IE5vZGVDbGFzcygpO1xyXG4gICAgdGhpcy5fc3RhZ2UuQW5ndWxhckNvbXBvbmVudCA9IHRoaXM7XHJcbiAgICBjb25zdCBhbmltYXRpb25TdGFnZSA9IHRoaXMuX3N0YWdlLnRvLmJpbmQodGhpcy5fc3RhZ2UpO1xyXG5cclxuICAgIHRoaXMuX3N0YWdlLnRvID0gZnVuY3Rpb24obmV3Q29uZmlnKSB7XHJcbiAgICAgIGFuaW1hdGlvblN0YWdlKG5ld0NvbmZpZyk7XHJcbiAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgIE9iamVjdC5rZXlzKG5nLl9zdGFnZS5hdHRycykuZm9yRWFjaChrZXkgPT4ge1xyXG4gICAgICAgICAgaWYgKHR5cGVvZiBuZy5fc3RhZ2UuYXR0cnNba2V5XSAhPT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICBuZy5jb25maWdba2V5XSA9IG5nLl9zdGFnZS5hdHRyc1trZXldO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9LCAyMDApO1xyXG4gICAgfTtcclxuICAgIGlmICh0aGlzLmNvbmZpZykge1xyXG4gICAgICB0aGlzLmNvbmZpZy5zdWJzY3JpYmUoY29uZmlnID0+IHtcclxuICAgICAgICB0aGlzLl9jb25maWcgPSBjb25maWc7XHJcbiAgICAgICAgdGhpcy51cGxvYWRLb252YShjb25maWcpO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgdXBsb2FkS29udmEoY29uZmlnKSB7XHJcbiAgICBjb25zdCBwcm9wcyA9IHtcclxuICAgICAgLi4uY29uZmlnLFxyXG4gICAgICAuLi5jcmVhdGVMaXN0ZW5lcih0aGlzKVxyXG4gICAgfTtcclxuICAgIGFwcGx5Tm9kZVByb3BzKHRoaXMsIHByb3BzLCB0aGlzLmNhY2hlUHJvcHMpO1xyXG4gICAgdGhpcy5jYWNoZVByb3BzID0gcHJvcHM7XHJcbiAgfVxyXG5cclxuICBuZ0FmdGVyQ29udGVudEluaXQoKSB7XHJcbiAgICB0aGlzLnNoYXBlcy5mb3JFYWNoKChpdGVtOiBDb3JlU2hhcGVDb21wb25lbnQpID0+IHtcclxuICAgICAgaWYgKHRoaXMgIT09IGl0ZW0pIHtcclxuICAgICAgICBpdGVtLmFkZGVkID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLl9zdGFnZS5hZGQoaXRlbS5nZXRTdGFnZSgpKTtcclxuICAgICAgICB1cGRhdGVQaWN0dXJlKHRoaXMuX3N0YWdlKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBuZ09uRGVzdHJveSgpIHtcclxuICAgIHRoaXMuX3N0YWdlLmRlc3Ryb3koKTtcclxuICB9XHJcbn1cclxuIiwiaW1wb3J0IHtcclxuICBDb21wb25lbnQsXHJcbiAgSW5wdXQsXHJcbiAgT3V0cHV0LFxyXG4gIEV2ZW50RW1pdHRlcixcclxuICBBZnRlckNvbnRlbnRJbml0LFxyXG4gIEVsZW1lbnRSZWYsXHJcbiAgQ29udGVudENoaWxkcmVuLFxyXG4gIFF1ZXJ5TGlzdCxcclxuICBPbkluaXQsXHJcbiAgT25EZXN0cm95XHJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IENvcmVTaGFwZUNvbXBvbmVudCBhcyBDb3JlU2hhcGUgfSBmcm9tICcuL2NvcmUtc2hhcGUuY29tcG9uZW50JztcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyB1cGRhdGVQaWN0dXJlLCBjcmVhdGVMaXN0ZW5lciwgYXBwbHlOb2RlUHJvcHMgfSBmcm9tICcuLi91dGlscy9pbmRleCc7XHJcbmltcG9ydCB7IEtvbnZhQ29tcG9uZW50IH0gZnJvbSAnLi4va28uaW50ZXJmYWNlJztcclxuXHJcbmRlY2xhcmUgY29uc3QgS29udmE6IGFueTtcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAna28tc3RhZ2UnLFxyXG4gIHRlbXBsYXRlOiBgPGRpdj48bmctY29udGVudD48L25nLWNvbnRlbnQ+e3tjb25maWd9fTwvZGl2PmBcclxufSlcclxuZXhwb3J0IGNsYXNzIFN0YWdlQ29tcG9uZW50XHJcbiAgaW1wbGVtZW50cyBLb252YUNvbXBvbmVudCwgQWZ0ZXJDb250ZW50SW5pdCwgT25Jbml0LCBPbkRlc3Ryb3kge1xyXG4gIEBDb250ZW50Q2hpbGRyZW4oQ29yZVNoYXBlKSBzaGFwZXMgPSBuZXcgUXVlcnlMaXN0PENvcmVTaGFwZT4oKTtcclxuICBASW5wdXQoKSBjb25maWc6IE9ic2VydmFibGU8YW55PjtcclxuICBAT3V0cHV0KCkgY2xpY2s6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gIEBPdXRwdXQoKSBkYmxjbGljazogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgQE91dHB1dCgpIG1vdXNlb3ZlcjogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgQE91dHB1dCgpIG1vdXNlb3V0OiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICBAT3V0cHV0KCkgbW91c2Vtb3ZlOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICBAT3V0cHV0KCkgdGFwOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICBAT3V0cHV0KCkgZGJsdGFwOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICBAT3V0cHV0KCkgdG91Y2hzdGFydDogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgQE91dHB1dCgpIHNjYWxlWENoYW5nZTogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgQE91dHB1dCgpIGZpbGxDaGFuZ2U6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gIEBPdXRwdXQoKSBkcmFnc3RhcnQ6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gIEBPdXRwdXQoKSBkcmFnbW92ZTogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgQE91dHB1dCgpIGRyYWdlbmQ6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG5cclxuICBwcml2YXRlIF9zdGFnZTtcclxuICBwcml2YXRlIF9jb25maWc7XHJcbiAgcHJpdmF0ZSBjYWNoZVByb3BzOiBhbnkgPSB7fTtcclxuXHJcbiAgcHVibGljIGdldFN0YWdlKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuX3N0YWdlIHx8IHt9O1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldENvbmZpZygpIHtcclxuICAgIHJldHVybiB0aGlzLl9jb25maWcgfHwge307XHJcbiAgfVxyXG5cclxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGVsZW1lbnRSZWY6IEVsZW1lbnRSZWYpIHt9XHJcblxyXG4gIHByaXZhdGUgdXBsb2FkS29udmEoY29uZmlnKSB7XHJcbiAgICBjb25zdCBwcm9wcyA9IHtcclxuICAgICAgLi4uY29uZmlnLFxyXG4gICAgICAuLi5jcmVhdGVMaXN0ZW5lcih0aGlzKVxyXG4gICAgfTtcclxuICAgIGFwcGx5Tm9kZVByb3BzKHRoaXMsIHByb3BzLCB0aGlzLmNhY2hlUHJvcHMpO1xyXG4gICAgdGhpcy5jYWNoZVByb3BzID0gcHJvcHM7XHJcbiAgfVxyXG5cclxuICBuZ09uSW5pdCgpIHtcclxuICAgIGNvbnN0IG5vZGVDb250YWluZXIgPSB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudDtcclxuICAgIHRoaXMuY29uZmlnLnN1YnNjcmliZShjb25maWcgPT4ge1xyXG4gICAgICB0aGlzLl9jb25maWcgPSBjb25maWc7XHJcbiAgICAgIGlmICghdGhpcy5fc3RhZ2UpIHtcclxuICAgICAgICB0aGlzLl9zdGFnZSA9IG5ldyBLb252YS5TdGFnZSh7XHJcbiAgICAgICAgICB3aWR0aDogY29uZmlnLndpZHRoLFxyXG4gICAgICAgICAgaGVpZ2h0OiBjb25maWcuaGVpZ2h0LFxyXG4gICAgICAgICAgY29udGFpbmVyOiBub2RlQ29udGFpbmVyXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy51cGxvYWRLb252YShjb25maWcpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMudXBsb2FkS29udmEoY29uZmlnKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBuZ0FmdGVyQ29udGVudEluaXQoKSB7XHJcbiAgICB0aGlzLnNoYXBlcy5mb3JFYWNoKChpdGVtOiBDb3JlU2hhcGUpID0+IHtcclxuICAgICAgdGhpcy5fc3RhZ2UuYWRkKGl0ZW0uZ2V0U3RhZ2UoKSk7XHJcbiAgICAgIHVwZGF0ZVBpY3R1cmUodGhpcy5fc3RhZ2UpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBuZ09uRGVzdHJveSgpIHtcclxuICAgIHRoaXMuX3N0YWdlLmRlc3Ryb3koKTtcclxuICB9XHJcbn1cclxuIiwiaW1wb3J0IHsgTmdNb2R1bGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgQ29tbW9uTW9kdWxlIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcclxuaW1wb3J0IHsgU3RhZ2VDb21wb25lbnQgfSBmcm9tICcuL2NvbXBvbmVudHMvc3RhZ2UuY29tcG9uZW50JztcclxuaW1wb3J0IHsgQ29yZVNoYXBlQ29tcG9uZW50IH0gZnJvbSAnLi9jb21wb25lbnRzL2NvcmUtc2hhcGUuY29tcG9uZW50JztcclxuXHJcbmRlY2xhcmUgZ2xvYmFsIHtcclxuICBpbnRlcmZhY2UgV2luZG93IHsgS29udmE6IGFueTsgfVxyXG59XHJcblxyXG5pZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgJiYgIXdpbmRvdy5Lb252YSkge1xyXG4gIHJlcXVpcmUoJ2tvbnZhJyk7XHJcbn1cclxuXHJcbmV4cG9ydCAqIGZyb20gJy4vY29tcG9uZW50cy9zdGFnZS5jb21wb25lbnQnO1xyXG5leHBvcnQgKiBmcm9tICcuL2NvbXBvbmVudHMvY29yZS1zaGFwZS5jb21wb25lbnQnO1xyXG5leHBvcnQgeyBLb252YUNvbXBvbmVudCB9IGZyb20gJy4va28uaW50ZXJmYWNlJztcclxuXHJcbkBOZ01vZHVsZSh7XHJcbiAgaW1wb3J0czogW1xyXG4gICAgQ29tbW9uTW9kdWxlXHJcbiAgXSxcclxuICBkZWNsYXJhdGlvbnM6IFtcclxuICAgIFN0YWdlQ29tcG9uZW50LFxyXG4gICAgQ29yZVNoYXBlQ29tcG9uZW50LFxyXG4gIF0sXHJcbiAgZXhwb3J0czogW1xyXG4gICAgU3RhZ2VDb21wb25lbnQsXHJcbiAgICBDb3JlU2hhcGVDb21wb25lbnQsXHJcbiAgXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgS29udmFNb2R1bGUge1xyXG59XHJcbiJdLCJuYW1lcyI6WyJRdWVyeUxpc3QiLCJFdmVudEVtaXR0ZXIiLCJDb21wb25lbnQiLCJFbGVtZW50UmVmIiwiQ29udGVudENoaWxkcmVuIiwiSW5wdXQiLCJPdXRwdXQiLCJDb3JlU2hhcGUiLCJOZ01vZHVsZSIsIkNvbW1vbk1vZHVsZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0lBQUE7Ozs7Ozs7Ozs7Ozs7O0FBY0EsSUFlTyxJ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