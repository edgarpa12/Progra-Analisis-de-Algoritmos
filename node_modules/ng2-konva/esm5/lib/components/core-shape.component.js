/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, Input, Output, EventEmitter, ElementRef, ContentChildren, QueryList, } from '@angular/core';
import { Observable } from 'rxjs';
import { getName, createListener, applyNodeProps, updatePicture } from '../utils/index';
var CoreShapeComponent = /** @class */ (function () {
    function CoreShapeComponent(elementRef) {
        this.elementRef = elementRef;
        this.shapes = new QueryList();
        this.click = new EventEmitter();
        this.dblclick = new EventEmitter();
        this.mouseover = new EventEmitter();
        this.mouseout = new EventEmitter();
        this.mousemove = new EventEmitter();
        this.tap = new EventEmitter();
        this.dbltap = new EventEmitter();
        this.touchstart = new EventEmitter();
        this.scaleXChange = new EventEmitter();
        this.fillChange = new EventEmitter();
        this.dragstart = new EventEmitter();
        this.dragmove = new EventEmitter();
        this.dragend = new EventEmitter();
        this.added = false;
        this.cacheProps = {};
        this._stage = {};
        this.nameNode = getName(elementRef.nativeElement.localName);
    }
    /**
     * @return {?}
     */
    CoreShapeComponent.prototype.getStage = /**
     * @return {?}
     */
    function () {
        return this._stage;
    };
    /**
     * @return {?}
     */
    CoreShapeComponent.prototype.getConfig = /**
     * @return {?}
     */
    function () {
        return this._config || {};
    };
    /**
     * @return {?}
     */
    CoreShapeComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.initKonva();
    };
    /**
     * @return {?}
     */
    CoreShapeComponent.prototype.initKonva = /**
     * @return {?}
     */
    function () {
        var _this = this;
        var /** @type {?} */ ng = this;
        var /** @type {?} */ NodeClass = Konva[this.nameNode];
        this._stage = new NodeClass();
        this._stage.AngularComponent = this;
        var /** @type {?} */ animationStage = this._stage.to.bind(this._stage);
        this._stage.to = function (newConfig) {
            animationStage(newConfig);
            setTimeout(function () {
                Object.keys(ng._stage.attrs).forEach(function (key) {
                    if (typeof ng._stage.attrs[key] !== 'function') {
                        ng.config[key] = ng._stage.attrs[key];
                    }
                });
            }, 200);
        };
        if (this.config) {
            this.config.subscribe(function (config) {
                _this._config = config;
                _this.uploadKonva(config);
            });
        }
    };
    /**
     * @param {?} config
     * @return {?}
     */
    CoreShapeComponent.prototype.uploadKonva = /**
     * @param {?} config
     * @return {?}
     */
    function (config) {
        var /** @type {?} */ props = tslib_1.__assign({}, config, createListener(this));
        applyNodeProps(this, props, this.cacheProps);
        this.cacheProps = props;
    };
    /**
     * @return {?}
     */
    CoreShapeComponent.prototype.ngAfterContentInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.shapes.forEach(function (item) {
            if (_this !== item) {
                item.added = true;
                _this._stage.add(item.getStage());
                updatePicture(_this._stage);
            }
        });
    };
    /**
     * @return {?}
     */
    CoreShapeComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this._stage.destroy();
    };
    CoreShapeComponent.decorators = [
        { type: Component, args: [{
                    // tslint:disable-next-line:max-line-length
                    selector: 'ko-shape, ko-layer, ko-circle, ko-fastlayer, ko-group, ko-label, ko-rect, ko-ellipse, ko-wedge, ko-line, ko-sprite, ko-image, ko-text, ko-text-path, ko-star, ko-ring, ko-arc, ko-tag, ko-path, ko-regular-polygon, ko-arrow',
                    template: "<div><ng-content></ng-content></div>"
                },] },
    ];
    /** @nocollapse */
    CoreShapeComponent.ctorParameters = function () { return [
        { type: ElementRef }
    ]; };
    CoreShapeComponent.propDecorators = {
        shapes: [{ type: ContentChildren, args: [CoreShapeComponent,] }],
        config: [{ type: Input }],
        click: [{ type: Output }],
        dblclick: [{ type: Output }],
        mouseover: [{ type: Output }],
        mouseout: [{ type: Output }],
        mousemove: [{ type: Output }],
        tap: [{ type: Output }],
        dbltap: [{ type: Output }],
        touchstart: [{ type: Output }],
        scaleXChange: [{ type: Output }],
        fillChange: [{ type: Output }],
        dragstart: [{ type: Output }],
        dragmove: [{ type: Output }],
        dragend: [{ type: Output }]
    };
    return CoreShapeComponent;
}());
export { CoreShapeComponent };
function CoreShapeComponent_tsickle_Closure_declarations() {
    /** @type {?} */
    CoreShapeComponent.prototype.shapes;
    /** @type {?} */
    CoreShapeComponent.prototype.config;
    /** @type {?} */
    CoreShapeComponent.prototype.click;
    /** @type {?} */
    CoreShapeComponent.prototype.dblclick;
    /** @type {?} */
    CoreShapeComponent.prototype.mouseover;
    /** @type {?} */
    CoreShapeComponent.prototype.mouseout;
    /** @type {?} */
    CoreShapeComponent.prototype.mousemove;
    /** @type {?} */
    CoreShapeComponent.prototype.tap;
    /** @type {?} */
    CoreShapeComponent.prototype.dbltap;
    /** @type {?} */
    CoreShapeComponent.prototype.touchstart;
    /** @type {?} */
    CoreShapeComponent.prototype.scaleXChange;
    /** @type {?} */
    CoreShapeComponent.prototype.fillChange;
    /** @type {?} */
    CoreShapeComponent.prototype.dragstart;
    /** @type {?} */
    CoreShapeComponent.prototype.dragmove;
    /** @type {?} */
    CoreShapeComponent.prototype.dragend;
    /** @type {?} */
    CoreShapeComponent.prototype.nameNode;
    /** @type {?} */
    CoreShapeComponent.prototype.added;
    /** @type {?} */
    CoreShapeComponent.prototype.cacheProps;
    /** @type {?} */
    CoreShapeComponent.prototype._stage;
    /** @type {?} */
    CoreShapeComponent.prototype._config;
    /** @type {?} */
    CoreShapeComponent.prototype.elementRef;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29yZS1zaGFwZS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZzIta29udmEvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9jb3JlLXNoYXBlLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFDTCxTQUFTLEVBQ1QsS0FBSyxFQUNMLE1BQU0sRUFDTixZQUFZLEVBQ1osVUFBVSxFQUVWLGVBQWUsRUFDZixTQUFTLEdBR1YsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNsQyxPQUFPLEVBQ0wsT0FBTyxFQUNQLGNBQWMsRUFDZCxjQUFjLEVBQ2QsYUFBYSxFQUNkLE1BQU0sZ0JBQWdCLENBQUM7O0lBOEN0Qiw0QkFBb0IsVUFBc0I7UUFBdEIsZUFBVSxHQUFWLFVBQVUsQ0FBWTtzQkEvQmpDLElBQUksU0FBUyxFQUFzQjtxQkFFUCxJQUFJLFlBQVksRUFBRTt3QkFDZixJQUFJLFlBQVksRUFBRTt5QkFDakIsSUFBSSxZQUFZLEVBQUU7d0JBQ25CLElBQUksWUFBWSxFQUFFO3lCQUNqQixJQUFJLFlBQVksRUFBRTttQkFDeEIsSUFBSSxZQUFZLEVBQUU7c0JBQ2YsSUFBSSxZQUFZLEVBQUU7MEJBQ2QsSUFBSSxZQUFZLEVBQUU7NEJBQ2hCLElBQUksWUFBWSxFQUFFOzBCQUNwQixJQUFJLFlBQVksRUFBRTt5QkFDbkIsSUFBSSxZQUFZLEVBQUU7d0JBQ25CLElBQUksWUFBWSxFQUFFO3VCQUNuQixJQUFJLFlBQVksRUFBRTtxQkFHMUMsS0FBSzswQkFFTSxFQUFFO3NCQUNOLEVBQUU7UUFZdEIsSUFBSSxDQUFDLFFBQVEsR0FBRyxPQUFPLENBQUMsVUFBVSxDQUFDLGFBQWEsQ0FBQyxTQUFTLENBQUMsQ0FBQztLQUM3RDs7OztJQVZNLHFDQUFROzs7O1FBQ2IsTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUM7Ozs7O0lBR2Qsc0NB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OzRCQUNOLE1BQU07MkJBQ04sTUFBTTswQkFDTixNQUFNOzs2QkEvQ1Q7O1NBOEJhLGtCQUFrQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XHJcbiAgQ29tcG9uZW50LFxyXG4gIElucHV0LFxyXG4gIE91dHB1dCxcclxuICBFdmVudEVtaXR0ZXIsXHJcbiAgRWxlbWVudFJlZixcclxuICBBZnRlckNvbnRlbnRJbml0LFxyXG4gIENvbnRlbnRDaGlsZHJlbixcclxuICBRdWVyeUxpc3QsXHJcbiAgT25EZXN0cm95LFxyXG4gIE9uSW5pdCxcclxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQge1xyXG4gIGdldE5hbWUsXHJcbiAgY3JlYXRlTGlzdGVuZXIsXHJcbiAgYXBwbHlOb2RlUHJvcHMsXHJcbiAgdXBkYXRlUGljdHVyZVxyXG59IGZyb20gJy4uL3V0aWxzL2luZGV4JztcclxuaW1wb3J0IHsgS29udmFDb21wb25lbnQgfSBmcm9tICcuLi9rby5pbnRlcmZhY2UnO1xyXG5cclxuZGVjbGFyZSBjb25zdCBLb252YTogYW55O1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm1heC1saW5lLWxlbmd0aFxyXG4gIHNlbGVjdG9yOlxyXG4gICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm1heC1saW5lLWxlbmd0aFxyXG4gICAgJ2tvLXNoYXBlLCBrby1sYXllciwga28tY2lyY2xlLCBrby1mYXN0bGF5ZXIsIGtvLWdyb3VwLCBrby1sYWJlbCwga28tcmVjdCwga28tZWxsaXBzZSwga28td2VkZ2UsIGtvLWxpbmUsIGtvLXNwcml0ZSwga28taW1hZ2UsIGtvLXRleHQsIGtvLXRleHQtcGF0aCwga28tc3Rhciwga28tcmluZywga28tYXJjLCBrby10YWcsIGtvLXBhdGgsIGtvLXJlZ3VsYXItcG9seWdvbiwga28tYXJyb3cnLFxyXG4gIHRlbXBsYXRlOiBgPGRpdj48bmctY29udGVudD48L25nLWNvbnRlbnQ+PC9kaXY+YFxyXG59KVxyXG5leHBvcnQgY2xhc3MgQ29yZVNoYXBlQ29tcG9uZW50XHJcbiAgaW1wbGVtZW50cyBLb252YUNvbXBvbmVudCwgQWZ0ZXJDb250ZW50SW5pdCwgT25EZXN0cm95LCBPbkluaXQge1xyXG4gIEBDb250ZW50Q2hpbGRyZW4oQ29yZVNoYXBlQ29tcG9uZW50KVxyXG4gIHNoYXBlcyA9IG5ldyBRdWVyeUxpc3Q8Q29yZVNoYXBlQ29tcG9uZW50PigpO1xyXG4gIEBJbnB1dCgpIGNvbmZpZzogT2JzZXJ2YWJsZTxhbnk+O1xyXG4gIEBPdXRwdXQoKSBjbGljazogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgQE91dHB1dCgpIGRibGNsaWNrOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICBAT3V0cHV0KCkgbW91c2VvdmVyOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICBAT3V0cHV0KCkgbW91c2VvdXQ6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gIEBPdXRwdXQoKSBtb3VzZW1vdmU6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gIEBPdXRwdXQoKSB0YXA6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gIEBPdXRwdXQoKSBkYmx0YXA6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gIEBPdXRwdXQoKSB0b3VjaHN0YXJ0OiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICBAT3V0cHV0KCkgc2NhbGVYQ2hhbmdlOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICBAT3V0cHV0KCkgZmlsbENoYW5nZTogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgQE91dHB1dCgpIGRyYWdzdGFydDogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgQE91dHB1dCgpIGRyYWdtb3ZlOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICBAT3V0cHV0KCkgZHJhZ2VuZDogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcblxyXG4gIHB1YmxpYyBuYW1lTm9kZTogc3RyaW5nO1xyXG4gIHB1YmxpYyBhZGRlZCA9IGZhbHNlO1xyXG5cclxuICBwcml2YXRlIGNhY2hlUHJvcHM6IGFueSA9IHt9O1xyXG4gIHByaXZhdGUgX3N0YWdlOiBhbnkgPSB7fTtcclxuICBwcml2YXRlIF9jb25maWc7XHJcblxyXG4gIHB1YmxpYyBnZXRTdGFnZSgpIHtcclxuICAgIHJldHVybiB0aGlzLl9zdGFnZTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXRDb25maWcoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fY29uZmlnIHx8IHt9O1xyXG4gIH1cclxuXHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBlbGVtZW50UmVmOiBFbGVtZW50UmVmKSB7XHJcbiAgICB0aGlzLm5hbWVOb2RlID0gZ2V0TmFtZShlbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQubG9jYWxOYW1lKTtcclxuICB9XHJcblxyXG4gIG5nT25Jbml0KCkge1xyXG4gICAgdGhpcy5pbml0S29udmEoKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgaW5pdEtvbnZhKCkge1xyXG4gICAgY29uc3QgbmcgPSB0aGlzO1xyXG4gICAgY29uc3QgTm9kZUNsYXNzID0gS29udmFbdGhpcy5uYW1lTm9kZV07XHJcbiAgICB0aGlzLl9zdGFnZSA9IG5ldyBOb2RlQ2xhc3MoKTtcclxuICAgIHRoaXMuX3N0YWdlLkFuZ3VsYXJDb21wb25lbnQgPSB0aGlzO1xyXG4gICAgY29uc3QgYW5pbWF0aW9uU3RhZ2UgPSB0aGlzLl9zdGFnZS50by5iaW5kKHRoaXMuX3N0YWdlKTtcclxuXHJcbiAgICB0aGlzLl9zdGFnZS50byA9IGZ1bmN0aW9uKG5ld0NvbmZpZykge1xyXG4gICAgICBhbmltYXRpb25TdGFnZShuZXdDb25maWcpO1xyXG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICBPYmplY3Qua2V5cyhuZy5fc3RhZ2UuYXR0cnMpLmZvckVhY2goa2V5ID0+IHtcclxuICAgICAgICAgIGlmICh0eXBlb2YgbmcuX3N0YWdlLmF0dHJzW2tleV0gIT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgbmcuY29uZmlnW2tleV0gPSBuZy5fc3RhZ2UuYXR0cnNba2V5XTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgfSwgMjAwKTtcclxuICAgIH07XHJcbiAgICBpZiAodGhpcy5jb25maWcpIHtcclxuICAgICAgdGhpcy5jb25maWcuc3Vic2NyaWJlKGNvbmZpZyA9PiB7XHJcbiAgICAgICAgdGhpcy5fY29uZmlnID0gY29uZmlnO1xyXG4gICAgICAgIHRoaXMudXBsb2FkS29udmEoY29uZmlnKTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHVwbG9hZEtvbnZhKGNvbmZpZykge1xyXG4gICAgY29uc3QgcHJvcHMgPSB7XHJcbiAgICAgIC4uLmNvbmZpZyxcclxuICAgICAgLi4uY3JlYXRlTGlzdGVuZXIodGhpcylcclxuICAgIH07XHJcbiAgICBhcHBseU5vZGVQcm9wcyh0aGlzLCBwcm9wcywgdGhpcy5jYWNoZVByb3BzKTtcclxuICAgIHRoaXMuY2FjaGVQcm9wcyA9IHByb3BzO1xyXG4gIH1cclxuXHJcbiAgbmdBZnRlckNvbnRlbnRJbml0KCkge1xyXG4gICAgdGhpcy5zaGFwZXMuZm9yRWFjaCgoaXRlbTogQ29yZVNoYXBlQ29tcG9uZW50KSA9PiB7XHJcbiAgICAgIGlmICh0aGlzICE9PSBpdGVtKSB7XHJcbiAgICAgICAgaXRlbS5hZGRlZCA9IHRydWU7XHJcbiAgICAgICAgdGhpcy5fc3RhZ2UuYWRkKGl0ZW0uZ2V0U3RhZ2UoKSk7XHJcbiAgICAgICAgdXBkYXRlUGljdHVyZSh0aGlzLl9zdGFnZSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgbmdPbkRlc3Ryb3koKSB7XHJcbiAgICB0aGlzLl9zdGFnZS5kZXN0cm95KCk7XHJcbiAgfVxyXG59XHJcbiJdfQ==